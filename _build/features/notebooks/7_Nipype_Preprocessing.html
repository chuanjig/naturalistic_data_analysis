---
redirect_from:
  - "/features/notebooks/7-nipype-preprocessing"
interact_link: content/features/notebooks/7_Nipype_Preprocessing.ipynb
kernel_name: python3
kernel_path: content/features/notebooks
has_widgets: false
title: |-
  Building Preprocessing Workflows with Nipype
pagenum: 16
prev_page:
  url: /features/notebooks/6_Nipype_Quickstart.html
next_page:
  url: /features/notebooks/8_fmriprep_tutorial.html
suffix: .ipynb
search: workflow node lets need functional mask images run want output image data motion specify probability create step just matter e fsls preprocessing nodes coregistration connect analysis nipype subjects following note also input above gray function list file its only correction detection apply created using threshold anatomical again map datasink hands might not right done dummy scans fsl segmentation later next parameter flirt susan section nice interfaces relevant handed our gunzip slice artifact smoothing binary keep infile directly rest outliers interface parameters used should maps bbr subject files still value well actually folder ipynb additional always investigate taken nipypetutorial before download

comment: "***PROGRAMMATICALLY GENERATED, DO NOT EDIT. SEE ORIGINAL FILES IN /content***"
---

    <main class="jupyter-page">
    <div id="page-info"><div id="page-title">Building Preprocessing Workflows with Nipype</div>
</div>
    <div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Hands-on-1:-How-to-create-a-fMRI-preprocessing-workflow">Hands-on 1: How to create a fMRI preprocessing workflow<a class="anchor-link" href="#Hands-on-1:-How-to-create-a-fMRI-preprocessing-workflow"> </a></h1><p><em>Written by Michael Notter &amp; Luke Chang</em></p>
<p>The purpose of this section is that you set-up a complete fMRI analysis workflow yourself. So that in the end, you are able to perform the analysis from A-Z, i.e. from preprocessing to group analysis. This section will cover the preprocessing part, and the section <a href="handson_analysis.ipynb">Hands-on 2: Analysis</a> will handle the analysis part.</p>
<p>We will use this opportunity to show you some nice additional interfaces/nodes that might not be relevant to your usual analysis. But it's always nice to know that they exist. And hopefully, this will encourage you to investigate all other interfaces that Nipype can bring to the tip of your finger.</p>
<p>This notebook was taken from a more comprehensive <a href="https://github.com/miykael/nipype_tutorial">tutorial</a> on nipype. I encourage you to check it out to learn about this tool in more depth.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Preparation">Preparation<a class="anchor-link" href="#Preparation"> </a></h2><p>Before we can start with anything we first need to download the data. For this hands-on, we will only use the right-handed subjects 2-4 and 7-9. This can be done very quickly with the following <code>datalad</code> command.</p>
<p><strong>Note:</strong> This might take a while, as datalad needs to download ~200MB of data</p>
<p><strong>Note: You only need to download the data if you are running this locally on your laptop.  The data is already available on jupyterhub!</strong></p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>%%bash
datalad get -J <span class="m">4</span> /data/ds000114/sub-0<span class="o">[</span><span class="m">234789</span><span class="o">]</span>/ses-test/anat/sub-0<span class="o">[</span><span class="m">234789</span><span class="o">]</span>_ses-test_T1w.nii.gz <span class="se">\</span>
                /data/ds000114/sub-0<span class="o">[</span><span class="m">234789</span><span class="o">]</span>/ses-test/func/*fingerfootlips*
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Preprocessing-Workflow-Structure">Preprocessing Workflow Structure<a class="anchor-link" href="#Preprocessing-Workflow-Structure"> </a></h1><p>So let's get our hands dirty. First things first, it's always good to know which interfaces you want to use in your workflow and in which order you want to execute them. For the preprocessing workflow, I recommend that we use the following nodes:</p>

<pre><code> 1. Gunzip (Nipype)
 2. Drop Dummy Scans (FSL)
 3. Slice Time Correction (SPM)
 4. Motion Correction (SPM)
 5. Artifact Detection
 6. Segmentation (SPM)
 7. Coregistration (FSL)
 8. Smoothing (FSL)
 9. Apply Binary Mask (FSL)
10. Remove Linear Trends (Nipype)

</code></pre>
<p><strong>Note:</strong> This workflow might be overkill concerning data manipulation, but it hopefully serves as a good Nipype exercise.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Imports">Imports<a class="anchor-link" href="#Imports"> </a></h2><p>It's always best to have all relevant module imports at the beginning of your script. So let's import what we most certainly need.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">plotting</span>

<span class="c1"># Get the Node and Workflow object</span>
<span class="kn">from</span> <span class="nn">nipype</span> <span class="kn">import</span> <span class="n">Node</span><span class="p">,</span> <span class="n">Workflow</span>

<span class="c1"># Specify which SPM to use</span>
<span class="kn">from</span> <span class="nn">nipype.interfaces.matlab</span> <span class="kn">import</span> <span class="n">MatlabCommand</span>
<span class="n">MatlabCommand</span><span class="o">.</span><span class="n">set_default_paths</span><span class="p">(</span><span class="s1">&#39;/optnfs/el7/spm/spm12&#39;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span>

<span class="n">your_netid</span> <span class="o">=</span> <span class="s1">&#39;f00275v&#39;</span>
<span class="n">data_dir</span> <span class="o">=</span> <span class="s1">&#39;/dartfs/rc/lab/P/Psych60/data/ds000114&#39;</span>
<span class="n">output_dir</span> <span class="o">=</span> <span class="s1">&#39;/dartfs/rc/lab/P/Psych60/students_output/</span><span class="si">%s</span><span class="s1">/7_nipype_preprocessing&#39;</span> <span class="o">%</span> <span class="n">your_netid</span>
<span class="c1"># data_dir = &#39;/dartfs-hpc/rc/home/v/f00275v/Psych60/data/brainomics_data&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Note:</strong> Ideally you would also put the imports of all the interfaces that you use here at the top. But as we will develop the workflow step by step, we can also import the relevant modules as we go.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Create-Nodes-and-Workflow-connections">Create Nodes and Workflow connections<a class="anchor-link" href="#Create-Nodes-and-Workflow-connections"> </a></h2><p>Let's create all the nodes that we need! Make sure to specify all relevant inputs and keep in mind which ones you later on need to connect in your pipeline.</p>
<h3 id="Workflow">Workflow<a class="anchor-link" href="#Workflow"> </a></h3><p>We recommend to create the workflow and establish all its connections at a later place in your script. This helps to have everything nicely together. But for this hands-on example, it makes sense to establish the connections between the nodes as we go.</p>
<p>And for this, we first need to create a workflow:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Create the workflow here</span>
<span class="c1"># Hint: use &#39;base_dir&#39; to specify where to store the working directory</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">preproc</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;work_preproc&#39;</span><span class="p">,</span> <span class="n">base_dir</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;output/&#39;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Gunzip">Gunzip<a class="anchor-link" href="#Gunzip"> </a></h3><p>I've already created the <code>Gunzip</code> node as a template for the other nodes. Also, we've specified an <code>in_file</code> here so that we can directly test the nodes without worrying about the Input/Output data stream to the workflow. This will be taken care of in a later section.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nipype.algorithms.misc</span> <span class="kn">import</span> <span class="n">Gunzip</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Specify example input file</span>
<span class="n">func_file</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;sub-07/ses-test/func/sub-07_ses-test_task-fingerfootlips_bold.nii.gz&#39;</span><span class="p">)</span>

<span class="c1"># Initiate Gunzip node</span>
<span class="n">gunzip_func</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">Gunzip</span><span class="p">(</span><span class="n">in_file</span><span class="o">=</span><span class="n">func_file</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;gunzip_func&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Drop-Dummy-Scans">Drop Dummy Scans<a class="anchor-link" href="#Drop-Dummy-Scans"> </a></h3><p>The functional images of this dataset were recorded with 4 dummy scans at the beginning (see the <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3641991/">corresponding publication</a>). But those dummy scans were not yet taken out from the functional images.</p>
<p>To better illustrate this, let's plot the time course of a random voxel of the just defined <code>func_file</code>:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn">nibabel</span> <span class="k">as</span> <span class="nn">nb</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">nb</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">func_file</span><span class="p">)</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="p">:]);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../../images/features/notebooks/7_Nipype_Preprocessing_14_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the figure above, we see that at the very beginning there are extreme values, which hint to the fact that steady state wasn't reached yet. Therefore, we want to exclude the dummy scans from the original data. This can be achieved with FSL's <code>ExtractROI</code>.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nipype.interfaces.fsl</span> <span class="kn">import</span> <span class="n">ExtractROI</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">extract</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">ExtractROI</span><span class="p">(</span><span class="n">t_min</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">t_size</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">output_type</span><span class="o">=</span><span class="s1">&#39;NIFTI&#39;</span><span class="p">),</span>
               <span class="n">name</span><span class="o">=</span><span class="s2">&quot;extract&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This <code>ExtractROI</code> node can now be connected to the <code>gunzip_func</code> node from above. To do this, we use the following command:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">preproc</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">gunzip_func</span><span class="p">,</span> <span class="n">extract</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)])])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">Exception</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-15-eee3193e21b8&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>preproc<span class="ansi-blue-fg">.</span>connect<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">(</span>gunzip_func<span class="ansi-blue-fg">,</span> extract<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;out_file&#39;</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;in_file&#39;</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/optnfs/el7/jupyterhub/envs/Psych60-Chang/lib/python3.7/site-packages/nipype/pipeline/engine/workflows.py</span> in <span class="ansi-cyan-fg">connect</span><span class="ansi-blue-fg">(self, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    178</span> Trying to connect <span class="ansi-blue-fg">%</span>s<span class="ansi-blue-fg">:</span><span class="ansi-blue-fg">%</span>s to <span class="ansi-blue-fg">%</span>s<span class="ansi-blue-fg">:</span><span class="ansi-blue-fg">%</span>s but input <span class="ansi-blue-fg">&#39;%s&#39;</span> of node <span class="ansi-blue-fg">&#39;%s&#39;</span> <span class="ansi-green-fg">is</span> already
<span class="ansi-green-intense-fg ansi-bold">    179</span> connected<span class="ansi-blue-fg">.</span>
<span class="ansi-green-fg">--&gt; 180</span><span class="ansi-red-fg"> &#34;&#34;&#34; % (srcnode, source, destnode, dest, dest, destnode))
</span><span class="ansi-green-intense-fg ansi-bold">    181</span>                 if not (hasattr(destnode, &#39;_interface&#39;) and
<span class="ansi-green-intense-fg ansi-bold">    182</span>                         (&#39;.io&#39; in str(destnode._interface.__class__) or any([

<span class="ansi-red-fg">Exception</span>: Trying to connect work_preproc.gunzip_func:out_file to work_preproc.extract:in_file but input &#39;in_file&#39; of node &#39;work_preproc.extract&#39; is already
connected.
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Slice-Time-Correction">Slice Time Correction<a class="anchor-link" href="#Slice-Time-Correction"> </a></h3><p>Now to the next step. Let's us SPM's <code>SliceTiming</code> to correct for slice wise acquisition of the volumes. As a reminder, the tutorial dataset was recorded...</p>
<ul>
<li>with a time repetition (TR) of 2.5 seconds</li>
<li>with 30 slices per volume</li>
<li>in an interleaved fashion, i.e. slice order is [1, 3, 5, 7, ..., 2, 4, 6, ..., 30]</li>
<li>with a time acquisition (TA) of 2.4167 seconds, i.e. <code>TR-(TR/num_slices)</code></li>
</ul>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nipype.interfaces.spm</span> <span class="kn">import</span> <span class="n">SliceTiming</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">slice_order</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">slice_order</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 23, 25, 27, 29, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30]
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Initiate SliceTiming node here</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">slicetime</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">SliceTiming</span><span class="p">(</span><span class="n">num_slices</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                             <span class="n">ref_slice</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
                             <span class="n">slice_order</span><span class="o">=</span><span class="n">slice_order</span><span class="p">,</span>
                             <span class="n">time_repetition</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span>
                             <span class="n">time_acquisition</span><span class="o">=</span><span class="mf">2.5</span><span class="o">-</span><span class="p">(</span><span class="mf">2.5</span><span class="o">/</span><span class="mi">30</span><span class="p">)),</span>
                 <span class="n">name</span><span class="o">=</span><span class="s1">&#39;slicetime&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now the next step is to connect the <code>SliceTiming</code> node to the rest of the workflow, i.e. the <code>ExtractROI</code> node.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Connect SliceTiming node to the other nodes here</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">preproc</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">extract</span><span class="p">,</span> <span class="n">slicetime</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;roi_file&#39;</span><span class="p">,</span> <span class="s1">&#39;in_files&#39;</span><span class="p">)])])</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Motion-Correction">Motion Correction<a class="anchor-link" href="#Motion-Correction"> </a></h3><p>To correct for motion in the scanner, we will be using FSL's <code>MCFLIRT</code>.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nipype.interfaces.fsl</span> <span class="kn">import</span> <span class="n">MCFLIRT</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Initate MCFLIRT node here</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mcflirt</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">MCFLIRT</span><span class="p">(</span><span class="n">mean_vol</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">save_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
               <span class="n">name</span><span class="o">=</span><span class="s2">&quot;mcflirt&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Connect the <code>MCFLIRT</code> node to the rest of the workflow.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Connect MCFLIRT node to the other nodes here</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">preproc</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">slicetime</span><span class="p">,</span> <span class="n">mcflirt</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;timecorrected_files&#39;</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)])])</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Artifact-Detection">Artifact Detection<a class="anchor-link" href="#Artifact-Detection"> </a></h3><p>We will use the really cool and useful <code>ArtifactDetection</code> tool from Nipype to detect motion and intensity outliers in the functional images. The interface is initiated as follows:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nipype.algorithms.rapidart</span> <span class="kn">import</span> <span class="n">ArtifactDetect</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">art</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">ArtifactDetect</span><span class="p">(</span><span class="n">norm_threshold</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                          <span class="n">zintensity_threshold</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                          <span class="n">mask_type</span><span class="o">=</span><span class="s1">&#39;spm_global&#39;</span><span class="p">,</span>
                          <span class="n">parameter_source</span><span class="o">=</span><span class="s1">&#39;FSL&#39;</span><span class="p">,</span>
                          <span class="n">use_differences</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
                          <span class="n">plot_type</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">),</span>
           <span class="n">name</span><span class="o">=</span><span class="s2">&quot;art&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The parameters above mean the following:</p>
<ul>
<li><code>norm_threshold</code> - Threshold to use to detect motion-related outliers when composite motion is being used</li>
<li><code>zintensity_threshold</code> - Intensity Z-threshold use to detection images that deviate from the mean</li>
<li><code>mask_type</code> - Type of mask that should be used to mask the functional data. <em>spm_global</em> uses an spm_global like calculation to determine the brain mask</li>
<li><code>parameter_source</code> - Source of movement parameters</li>
<li><code>use_differences</code> - If you want to use differences between successive motion (first element) and intensity parameter (second element) estimates in order to determine outliers</li>
</ul>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And this is how you connect this node to the rest of the workflow:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">preproc</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">mcflirt</span><span class="p">,</span> <span class="n">art</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="s1">&#39;realigned_files&#39;</span><span class="p">),</span>
                                 <span class="p">(</span><span class="s1">&#39;par_file&#39;</span><span class="p">,</span> <span class="s1">&#39;realignment_parameters&#39;</span><span class="p">)])</span>
                 <span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Segmentation-of-anatomical-image">Segmentation of anatomical image<a class="anchor-link" href="#Segmentation-of-anatomical-image"> </a></h3><p>Now let's work on the anatomical image. In particular, let's use SPM's <code>NewSegment</code> to create probability maps for the gray matter, white matter tissue and CSF.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nipype.interfaces.spm</span> <span class="kn">import</span> <span class="n">NewSegment</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Use the following tissue specification to get a GM and WM probability map</span>

<span class="n">tpm_img</span> <span class="o">=</span><span class="s1">&#39;/optnfs/el7/spm/spm12/tpm/TPM.nii&#39;</span>
<span class="n">tissue1</span> <span class="o">=</span> <span class="p">((</span><span class="n">tpm_img</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
<span class="n">tissue2</span> <span class="o">=</span> <span class="p">((</span><span class="n">tpm_img</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
<span class="n">tissue3</span> <span class="o">=</span> <span class="p">((</span><span class="n">tpm_img</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
<span class="n">tissue4</span> <span class="o">=</span> <span class="p">((</span><span class="n">tpm_img</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
<span class="n">tissue5</span> <span class="o">=</span> <span class="p">((</span><span class="n">tpm_img</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">4</span><span class="p">,</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
<span class="n">tissue6</span> <span class="o">=</span> <span class="p">((</span><span class="n">tpm_img</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
<span class="n">tissues</span> <span class="o">=</span> <span class="p">[</span><span class="n">tissue1</span><span class="p">,</span> <span class="n">tissue2</span><span class="p">,</span> <span class="n">tissue3</span><span class="p">,</span> <span class="n">tissue4</span><span class="p">,</span> <span class="n">tissue5</span><span class="p">,</span> <span class="n">tissue6</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Initiate NewSegment node here</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">segment</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">NewSegment</span><span class="p">(</span><span class="n">tissues</span><span class="o">=</span><span class="n">tissues</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;segment&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We will again be using a <code>Gunzip</code> node to unzip the anatomical image that we then want to use as input to the segmentation node. We again also need to specify the anatomical image that we want to use in this case. As before, this will later also be handled directly by the Input/Output stream.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Specify example input file</span>
<span class="n">anat_file</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;sub-07/ses-test/anat/sub-07_ses-test_T1w.nii.gz&#39;</span><span class="p">)</span>

<span class="c1"># Initiate Gunzip node</span>
<span class="n">gunzip_anat</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">Gunzip</span><span class="p">(</span><span class="n">in_file</span><span class="o">=</span><span class="n">anat_file</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;gunzip_anat&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we can connect the <code>NewSegment</code> node to the rest of the workflow.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Connect NewSegment node to the other nodes here</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">preproc</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">gunzip_anat</span><span class="p">,</span> <span class="n">segment</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="s1">&#39;channel_files&#39;</span><span class="p">)])])</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Compute-Coregistration-Matrix">Compute Coregistration Matrix<a class="anchor-link" href="#Compute-Coregistration-Matrix"> </a></h3><p>As a next step, we will make sure that the functional images are coregistered to the anatomical image. For this, we will use FSL's <code>FLIRT</code> function. As we just created a white matter probability map, we can use this together with the Boundary-Based Registration (BBR) cost function to optimize the image coregistration. As some helpful notes...</p>
<ul>
<li>use a degree of freedom of 6</li>
<li>specify the cost function as <code>bbr</code></li>
<li>use the <code>schedule='/usr/share/fsl/5.0/etc/flirtsch/bbr.sch'</code></li>
</ul>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nipype.interfaces.fsl</span> <span class="kn">import</span> <span class="n">FLIRT</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Initiate FLIRT node here</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">coreg</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">FLIRT</span><span class="p">(</span><span class="n">dof</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                   <span class="n">cost</span><span class="o">=</span><span class="s1">&#39;bbr&#39;</span><span class="p">,</span>
                   <span class="n">schedule</span><span class="o">=</span><span class="s1">&#39;/optnfs/el7/fsl/5.0.10/etc/flirtsch/bbr.sch&#39;</span><span class="p">,</span>
                   <span class="n">output_type</span><span class="o">=</span><span class="s1">&#39;NIFTI&#39;</span><span class="p">),</span>
             <span class="n">name</span><span class="o">=</span><span class="s2">&quot;coreg&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Connect FLIRT node to the other nodes here</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">preproc</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">gunzip_anat</span><span class="p">,</span> <span class="n">coreg</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="s1">&#39;reference&#39;</span><span class="p">)]),</span>
                 <span class="p">(</span><span class="n">mcflirt</span><span class="p">,</span> <span class="n">coreg</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;mean_img&#39;</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)])</span>
                 <span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As mentioned above, the <code>bbr</code> routine can use the subject-specific white matter probability map to guide the coregistration. But for this, we need to create a binary mask out of the WM probability map. This can easily be done by FSL's <code>Threshold</code> interface.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nipype.interfaces.fsl</span> <span class="kn">import</span> <span class="n">Threshold</span>

<span class="c1"># Threshold - Threshold WM probability image</span>
<span class="n">threshold_WM</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">Threshold</span><span class="p">(</span><span class="n">thresh</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                              <span class="n">args</span><span class="o">=</span><span class="s1">&#39;-bin&#39;</span><span class="p">,</span>
                              <span class="n">output_type</span><span class="o">=</span><span class="s1">&#39;NIFTI&#39;</span><span class="p">),</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;threshold_WM&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now, to select the WM probability map that the <code>NewSegment</code> node created, we need some helper function. Because the output field <code>partial_volume_files</code> form the segmentation node, will give us a list of files, i.e. <code>[[GM_prob], [WM_prob], [], [], [], []]</code>. Therefore, using the following function, we can select only the last element of this list.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Select WM segmentation file from segmentation output</span>
<span class="k">def</span> <span class="nf">get_wm</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">files</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Connecting the segmentation node with the threshold node</span>
<span class="n">preproc</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">segment</span><span class="p">,</span> <span class="n">threshold_WM</span><span class="p">,</span> <span class="p">[((</span><span class="s1">&#39;native_class_images&#39;</span><span class="p">,</span> <span class="n">get_wm</span><span class="p">),</span>
                                           <span class="s1">&#39;in_file&#39;</span><span class="p">)])])</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we can just connect this <code>Threshold</code> node to the coregistration node from above.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Connect Threshold node to coregistration node above here</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">preproc</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">threshold_WM</span><span class="p">,</span> <span class="n">coreg</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="s1">&#39;wm_seg&#39;</span><span class="p">)])])</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Apply-Coregistration-Matrix-to-functional-image">Apply Coregistration Matrix to functional image<a class="anchor-link" href="#Apply-Coregistration-Matrix-to-functional-image"> </a></h3><p>Now that we know the coregistration matrix to correctly overlay the functional mean image on the subject-specific anatomy, we need to apply to coregistration to the whole time series. This can be achieved with FSL's <code>FLIRT</code> as follows:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Specify the isometric voxel resolution you want after coregistration</span>
<span class="n">desired_voxel_iso</span> <span class="o">=</span> <span class="mi">4</span>

<span class="c1"># Apply coregistration warp to functional images</span>
<span class="n">applywarp</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">FLIRT</span><span class="p">(</span><span class="n">interp</span><span class="o">=</span><span class="s1">&#39;spline&#39;</span><span class="p">,</span>
                       <span class="n">apply_isoxfm</span><span class="o">=</span><span class="n">desired_voxel_iso</span><span class="p">,</span>
                       <span class="n">output_type</span><span class="o">=</span><span class="s1">&#39;NIFTI&#39;</span><span class="p">),</span>
                 <span class="n">name</span><span class="o">=</span><span class="s2">&quot;applywarp&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong><span style="color:red">Important</span></strong>: As you can see above, we also specified a variable <code>desired_voxel_iso</code>. This is very important at this stage, otherwise <code>FLIRT</code> will transform your functional images to a resolution of the anatomical image, which will dramatically increase the file size (e.g. to 1-10GB per file). If you don't want to change the voxel resolution, use the additional parameter <code>no_resample=True</code>. Important, for this to work, you still need to define <code>apply_isoxfm</code>.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Connecting the ApplyWarp node to all the other nodes</span>
<span class="n">preproc</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">mcflirt</span><span class="p">,</span> <span class="n">applywarp</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)]),</span>
                 <span class="p">(</span><span class="n">coreg</span><span class="p">,</span> <span class="n">applywarp</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out_matrix_file&#39;</span><span class="p">,</span> <span class="s1">&#39;in_matrix_file&#39;</span><span class="p">)]),</span>
                 <span class="p">(</span><span class="n">gunzip_anat</span><span class="p">,</span> <span class="n">applywarp</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="s1">&#39;reference&#39;</span><span class="p">)])</span>
                 <span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Smoothing">Smoothing<a class="anchor-link" href="#Smoothing"> </a></h3><p>Next step is image smoothing. The most simple way to do this is to use FSL's or SPM's <code>Smooth</code> function. But for learning purposes, let's use FSL's <code>SUSAN</code> workflow as it is implemented in Nipype. Note that this time, we are importing a workflow instead of an interface.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nipype.workflows.fmri.fsl.preprocess</span> <span class="kn">import</span> <span class="n">create_susan_smooth</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If you type <code>create_susan_smooth?</code> you can see how to specify the input variables to the susan workflow. In particular, they are...</p>
<ul>
<li><code>fwhm</code>: set this value to 4 (or whichever value you want)</li>
<li><code>mask_file</code>: will be created in a later step</li>
<li><code>in_file</code>: will be handled while connection to other nodes in the preproc workflow</li>
</ul>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Initiate SUSAN workflow here</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">susan</span> <span class="o">=</span> <span class="n">create_susan_smooth</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;susan&#39;</span><span class="p">)</span>
<span class="n">susan</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">inputnode</span><span class="o">.</span><span class="n">fwhm</span> <span class="o">=</span> <span class="mi">4</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Connect Threshold node to coregistration node above here</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">preproc</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">applywarp</span><span class="p">,</span> <span class="n">susan</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="s1">&#39;inputnode.in_files&#39;</span><span class="p">)])])</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Create-Binary-Mask">Create Binary Mask<a class="anchor-link" href="#Create-Binary-Mask"> </a></h3><p>There are many possible approaches on how you can mask your functional images. One of them is not at all, one is with a simple brain mask and one that only considers certain kind of brain tissue, e.g. gray matter.</p>
<p>For the current example, we want to create a dilated gray matter mask. For this purpose we need to:</p>
<ol>
<li>Resample the gray matter probability map to the same resolution as the functional images</li>
<li>Threshold this resampled probability map at a specific value</li>
<li>Dilate this mask by some voxels to make the mask less conservative and more inclusive</li>
</ol>
<p>The first step can be done in many ways (eg. using freesurfer's <code>mri_convert</code>, <code>nibabel</code>) but in our case, we will use FSL's <code>FLIRT</code>. The trick is to use the probability mask, as input file and a reference file.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nipype.interfaces.fsl</span> <span class="kn">import</span> <span class="n">FLIRT</span>

<span class="c1"># Initiate resample node</span>
<span class="n">resample</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">FLIRT</span><span class="p">(</span><span class="n">apply_isoxfm</span><span class="o">=</span><span class="n">desired_voxel_iso</span><span class="p">,</span>
                      <span class="n">output_type</span><span class="o">=</span><span class="s1">&#39;NIFTI&#39;</span><span class="p">),</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;resample&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The second and third step can luckily be done with just one node. We can take almost the same <code>Threshold</code> node as above. We just need to add another additional argument: <code>-dilF</code> - which applies a maximum filtering of all voxels.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nipype.interfaces.fsl</span> <span class="kn">import</span> <span class="n">Threshold</span>

<span class="c1"># Threshold - Threshold GM probability image</span>
<span class="n">mask_GM</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">Threshold</span><span class="p">(</span><span class="n">thresh</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                         <span class="n">args</span><span class="o">=</span><span class="s1">&#39;-bin -dilF&#39;</span><span class="p">,</span>
                         <span class="n">output_type</span><span class="o">=</span><span class="s1">&#39;NIFTI&#39;</span><span class="p">),</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;mask_GM&quot;</span><span class="p">)</span>

<span class="c1"># Select GM segmentation file from segmentation output</span>
<span class="k">def</span> <span class="nf">get_gm</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we can connect the resample and the gray matter mask node to the segmentation node and each other.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">preproc</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">segment</span><span class="p">,</span> <span class="n">resample</span><span class="p">,</span> <span class="p">[((</span><span class="s1">&#39;native_class_images&#39;</span><span class="p">,</span> <span class="n">get_gm</span><span class="p">),</span> <span class="s1">&#39;in_file&#39;</span><span class="p">),</span>
                                      <span class="p">((</span><span class="s1">&#39;native_class_images&#39;</span><span class="p">,</span> <span class="n">get_gm</span><span class="p">),</span> <span class="s1">&#39;reference&#39;</span><span class="p">)</span>
                                      <span class="p">]),</span>
                 <span class="p">(</span><span class="n">resample</span><span class="p">,</span> <span class="n">mask_GM</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)])</span>
                 <span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This should do the trick.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Apply-the-binary-mask">Apply the binary mask<a class="anchor-link" href="#Apply-the-binary-mask"> </a></h3><p>Now we can connect this dilated gray matter mask to the susan node, as well as actually applying this to the resulting smoothed images.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Connect gray matter Mask node to the susan workflow here</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">preproc</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">mask_GM</span><span class="p">,</span> <span class="n">susan</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="s1">&#39;inputnode.mask_file&#39;</span><span class="p">)])])</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To apply the mask to the smoothed functional images, we will use FSL's <code>ApplyMask</code> interface.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nipype.interfaces.fsl</span> <span class="kn">import</span> <span class="n">ApplyMask</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Important:</strong> The susan workflow gives out a list of files, i.e. <code>[smoothed_func.nii]</code> instead of just the filename directly. If we would use a normal <code>Node</code> for <code>ApplyMask</code> this would lead to the following error:</p>

<pre><code>TraitError: The 'in_file' trait of an ApplyMaskInput instance must be an existing file name, but a value of ['/output/work_preproc/susan/smooth/mapflow/_smooth0/asub-07_ses-test_task-fingerfootlips_bold_mcf_flirt_smooth.nii.gz'] &lt;class 'list'&gt; was specified.


</code></pre>
<p>To prevent this we will be using a <code>MapNode</code> and specify the <code>in_file</code> as it's iterfield. Like this, the node is capable to handle a list of inputs as it will know that it has to apply itself iteratively to the list of inputs.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nipype</span> <span class="kn">import</span> <span class="n">MapNode</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Initiate ApplyMask node here</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mask_func</span> <span class="o">=</span> <span class="n">MapNode</span><span class="p">(</span><span class="n">ApplyMask</span><span class="p">(</span><span class="n">output_type</span><span class="o">=</span><span class="s1">&#39;NIFTI&#39;</span><span class="p">),</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;mask_func&quot;</span><span class="p">,</span> 
                    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;in_file&quot;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Connect smoothed susan output file to ApplyMask node here</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">preproc</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">susan</span><span class="p">,</span> <span class="n">mask_func</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;outputnode.smoothed_files&#39;</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)]),</span>
                 <span class="p">(</span><span class="n">mask_GM</span><span class="p">,</span> <span class="n">mask_func</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="s1">&#39;mask_file&#39;</span><span class="p">)])</span>
                 <span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Remove-linear-trends-in-functional-images">Remove linear trends in functional images<a class="anchor-link" href="#Remove-linear-trends-in-functional-images"> </a></h3><p>Last but not least. Let's use Nipype's <code>TSNR</code> module to remove linear and quadratic trends in the functionally smoothed images. For this, you only have to specify the <code>regress_poly</code> parameter in the node initiation.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nipype.algorithms.confounds</span> <span class="kn">import</span> <span class="n">TSNR</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Initiate TSNR node here</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">detrend</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">TSNR</span><span class="p">(</span><span class="n">regress_poly</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;detrend&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Connect the detrend node to the other nodes here</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">preproc</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">mask_func</span><span class="p">,</span> <span class="n">detrend</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)])])</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Datainput-with-SelectFiles-and-iterables">Datainput with <code>SelectFiles</code> and <code>iterables</code><a class="anchor-link" href="#Datainput-with-SelectFiles-and-iterables"> </a></h2><p>This is all nice and well. But so far we still had to specify the input values for <code>gunzip_anat</code> and <code>gunzip_func</code> ourselves. How can we scale this up to multiple subjects and/or multiple functional images and make the workflow take the input directly from the BIDS dataset?</p>
<p>For this, we need <a href="../../../nipype_tutorial/notebooks/basic_data_input.ipynb#SelectFiles"><code>SelectFiles</code></a> and <a href="../../../nipype_tutorial/notebooks/basic_iteration.ipynb"><code>iterables</code></a>! It's rather simple, specify a template and fill-up the placeholder variables.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Import the SelectFiles</span>
<span class="kn">from</span> <span class="nn">nipype</span> <span class="kn">import</span> <span class="n">SelectFiles</span>

<span class="c1"># String template with {}-based strings</span>
<span class="n">templates</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;anat&#39;</span><span class="p">:</span> <span class="s1">&#39;sub-</span><span class="si">{subject_id}</span><span class="s1">/ses-</span><span class="si">{ses_id}</span><span class="s1">/anat/&#39;</span>
                     <span class="s1">&#39;sub-</span><span class="si">{subject_id}</span><span class="s1">_ses-test_T1w.nii.gz&#39;</span><span class="p">,</span>
             <span class="s1">&#39;func&#39;</span><span class="p">:</span> <span class="s1">&#39;sub-</span><span class="si">{subject_id}</span><span class="s1">/ses-</span><span class="si">{ses_id}</span><span class="s1">/func/&#39;</span>
                     <span class="s1">&#39;sub-</span><span class="si">{subject_id}</span><span class="s1">_ses-</span><span class="si">{ses_id}</span><span class="s1">_task-</span><span class="si">{task_id}</span><span class="s1">_bold.nii.gz&#39;</span><span class="p">}</span>

<span class="c1"># Create SelectFiles node</span>
<span class="n">sf</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">SelectFiles</span><span class="p">(</span><span class="n">templates</span><span class="p">,</span>
                      <span class="n">base_directory</span><span class="o">=</span><span class="n">data_dir</span><span class="p">,</span>
                      <span class="n">sort_filelist</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
          <span class="n">name</span><span class="o">=</span><span class="s1">&#39;selectfiles&#39;</span><span class="p">)</span>
<span class="n">sf</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">ses_id</span><span class="o">=</span><span class="s1">&#39;test&#39;</span>
<span class="n">sf</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">task_id</span><span class="o">=</span><span class="s1">&#39;fingerfootlips&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we can specify over which subjects the workflow should iterate. To test the workflow, let's still just look at subject 7.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">subject_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;07&#39;</span><span class="p">]</span>
<span class="n">sf</span><span class="o">.</span><span class="n">iterables</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;subject_id&#39;</span><span class="p">,</span> <span class="n">subject_list</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Connect SelectFiles node to the other nodes here</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">preproc</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">sf</span><span class="p">,</span> <span class="n">gunzip_anat</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;anat&#39;</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)]),</span>
                 <span class="p">(</span><span class="n">sf</span><span class="p">,</span> <span class="n">gunzip_func</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;func&#39;</span><span class="p">,</span> <span class="s1">&#39;in_file&#39;</span><span class="p">)])])</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Visualize-the-workflow">Visualize the workflow<a class="anchor-link" href="#Visualize-the-workflow"> </a></h2><p>Now that we're done. Let's look at the workflow that we just created.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Create preproc output graph</span>
<span class="n">preproc</span><span class="o">.</span><span class="n">write_graph</span><span class="p">(</span><span class="n">graph2use</span><span class="o">=</span><span class="s1">&#39;colored&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">simple_form</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Visualize the graph</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;output/work_preproc/graph.png&#39;</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">750</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>190416-10:45:49,342 nipype.workflow INFO:
	 Generated workflow graph: /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/graph.png (graph2use=colored, simple_form=True).
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea output_execute_result">
<img src="../../images/features/notebooks/7_Nipype_Preprocessing_106_1.png"
width=750
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Run-the-Workflow">Run the Workflow<a class="anchor-link" href="#Run-the-Workflow"> </a></h2><p>Now we are ready to run the workflow! Be careful about the <code>n_procs</code> parameter if you run a workflow in <code>'MultiProc'</code> mode. <code>n_procs</code> specifies the number of jobs/cores your computer will use to run the workflow. If this number is too high your computer will try to execute too many things at once and will most likely crash.</p>
<p><strong>Note</strong>: If  you're using a Docker container and FLIRT fails to run without any good reason, you might need to change memory settings in the Docker preferences (6 GB should be enough for this workflow).</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">preproc</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;MultiProc&#39;</span><span class="p">,</span> <span class="n">plugin_args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;n_procs&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">})</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>190416-10:45:58,544 nipype.workflow INFO:
	 Workflow work_preproc settings: [&#39;check&#39;, &#39;execution&#39;, &#39;logging&#39;, &#39;monitoring&#39;]
190416-10:45:58,736 nipype.workflow INFO:
	 Running in parallel.
190416-10:45:58,746 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 1 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 4/4.
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/optnfs/el7/jupyterhub/envs/Psych60-Chang/lib/python3.7/site-packages/numpy/matrixlib/defmatrix.py:71: PendingDeprecationWarning: the matrix subclass is not the recommended way to represent matrices or deal with linear algebra (see https://docs.scipy.org/doc/numpy/user/numpy-for-matlab-users.html). Please adjust your code to use regular ndarray.
  return matrix(data, dtype=dtype, copy=False)
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>190416-10:45:58,914 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.selectfiles&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/selectfiles&#34;.
190416-10:45:58,972 nipype.workflow INFO:
	 [Node] Running &#34;selectfiles&#34; (&#34;nipype.interfaces.io.SelectFiles&#34;)
190416-10:45:59,16 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.selectfiles&#34;.
190416-10:46:00,746 nipype.workflow INFO:
	 [Job 0] Completed (work_preproc.selectfiles).
190416-10:46:00,754 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 4/4.
190416-10:46:00,921 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.gunzip_func&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/gunzip_func&#34;.
190416-10:46:00,925 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.gunzip_anat&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/gunzip_anat&#34;.
190416-10:46:00,981 nipype.workflow INFO:
	 [Node] Running &#34;gunzip_func&#34; (&#34;nipype.algorithms.misc.Gunzip&#34;)
190416-10:46:00,994 nipype.workflow INFO:
	 [Node] Running &#34;gunzip_anat&#34; (&#34;nipype.algorithms.misc.Gunzip&#34;)
190416-10:46:02,748 nipype.workflow INFO:
	 [MultiProc] Running 2 tasks, and 0 jobs ready. Free memory (GB): 55.98/56.38, Free processors: 2/4.
                     Currently running:
                       * work_preproc.gunzip_anat
                       * work_preproc.gunzip_func
190416-10:46:12,741 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.gunzip_anat&#34;.
190416-10:46:12,756 nipype.workflow INFO:
	 [Job 6] Completed (work_preproc.gunzip_anat).
190416-10:46:12,761 nipype.workflow INFO:
	 [MultiProc] Running 1 tasks, and 1 jobs ready. Free memory (GB): 56.18/56.38, Free processors: 3/4.
                     Currently running:
                       * work_preproc.gunzip_func
190416-10:46:12,884 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.segment&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/segment&#34;.
190416-10:46:12,951 nipype.workflow INFO:
	 [Node] Running &#34;segment&#34; (&#34;nipype.interfaces.spm.preprocess.NewSegment&#34;)
190416-10:46:14,760 nipype.workflow INFO:
	 [MultiProc] Running 2 tasks, and 0 jobs ready. Free memory (GB): 55.98/56.38, Free processors: 2/4.
                     Currently running:
                       * work_preproc.segment
                       * work_preproc.gunzip_func
190416-10:46:14,798 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.gunzip_func&#34;.
190416-10:46:16,760 nipype.workflow INFO:
	 [Job 1] Completed (work_preproc.gunzip_func).
190416-10:46:16,766 nipype.workflow INFO:
	 [MultiProc] Running 1 tasks, and 1 jobs ready. Free memory (GB): 56.18/56.38, Free processors: 3/4.
                     Currently running:
                       * work_preproc.segment
190416-10:46:16,879 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.extract&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/extract&#34;.
190416-10:46:16,932 nipype.workflow INFO:
	 [Node] Running &#34;extract&#34; (&#34;nipype.interfaces.fsl.utils.ExtractROI&#34;), a CommandLine Interface with command:
fslroi /dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/gunzip_func/sub-07_ses-test_task-fingerfootlips_bold.nii /dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/extract/sub-07_ses-test_task-fingerfootlips_bold_roi.nii 4 -1
190416-10:46:18,764 nipype.workflow INFO:
	 [MultiProc] Running 2 tasks, and 0 jobs ready. Free memory (GB): 55.98/56.38, Free processors: 2/4.
                     Currently running:
                       * work_preproc.extract
                       * work_preproc.segment
190416-10:46:29,492 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.extract&#34;.
190416-10:46:30,775 nipype.workflow INFO:
	 [Job 2] Completed (work_preproc.extract).
190416-10:46:30,780 nipype.workflow INFO:
	 [MultiProc] Running 1 tasks, and 1 jobs ready. Free memory (GB): 56.18/56.38, Free processors: 3/4.
                     Currently running:
                       * work_preproc.segment
190416-10:46:30,891 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.slicetime&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/slicetime&#34;.
190416-10:46:30,942 nipype.workflow INFO:
	 [Node] Running &#34;slicetime&#34; (&#34;nipype.interfaces.spm.preprocess.SliceTiming&#34;)
190416-10:46:32,778 nipype.workflow INFO:
	 [MultiProc] Running 2 tasks, and 0 jobs ready. Free memory (GB): 55.98/56.38, Free processors: 2/4.
                     Currently running:
                       * work_preproc.slicetime
                       * work_preproc.segment
190416-10:48:28,71 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.slicetime&#34;.
190416-10:48:28,892 nipype.workflow INFO:
	 [Job 3] Completed (work_preproc.slicetime).
190416-10:48:28,898 nipype.workflow INFO:
	 [MultiProc] Running 1 tasks, and 1 jobs ready. Free memory (GB): 56.18/56.38, Free processors: 3/4.
                     Currently running:
                       * work_preproc.segment
190416-10:48:29,12 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.mcflirt&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/mcflirt&#34;.
190416-10:48:29,72 nipype.workflow INFO:
	 [Node] Running &#34;mcflirt&#34; (&#34;nipype.interfaces.fsl.preprocess.MCFLIRT&#34;), a CommandLine Interface with command:
mcflirt -in /dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/slicetime/asub-07_ses-test_task-fingerfootlips_bold_roi.nii -meanvol -out /dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/mcflirt/asub-07_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz -plots
190416-10:48:30,895 nipype.workflow INFO:
	 [MultiProc] Running 2 tasks, and 0 jobs ready. Free memory (GB): 55.98/56.38, Free processors: 2/4.
                     Currently running:
                       * work_preproc.mcflirt
                       * work_preproc.segment
190416-10:50:49,344 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.mcflirt&#34;.
190416-10:50:51,33 nipype.workflow INFO:
	 [Job 4] Completed (work_preproc.mcflirt).
190416-10:50:51,39 nipype.workflow INFO:
	 [MultiProc] Running 1 tasks, and 1 jobs ready. Free memory (GB): 56.18/56.38, Free processors: 3/4.
                     Currently running:
                       * work_preproc.segment
190416-10:50:51,156 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.art&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/art&#34;.
190416-10:50:51,212 nipype.workflow INFO:
	 [Node] Running &#34;art&#34; (&#34;nipype.algorithms.rapidart.ArtifactDetect&#34;)
190416-10:50:52,402 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.art&#34;.
190416-10:50:53,35 nipype.workflow INFO:
	 [Job 5] Completed (work_preproc.art).
190416-10:50:53,40 nipype.workflow INFO:
	 [MultiProc] Running 1 tasks, and 0 jobs ready. Free memory (GB): 56.18/56.38, Free processors: 3/4.
                     Currently running:
                       * work_preproc.segment
190416-10:51:55,769 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.segment&#34;.
190416-10:51:57,101 nipype.workflow INFO:
	 [Job 7] Completed (work_preproc.segment).
190416-10:51:57,106 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 4/4.
190416-10:51:57,228 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.resample&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/resample&#34;.
190416-10:51:57,238 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.threshold_WM&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/threshold_WM&#34;.
190416-10:51:57,286 nipype.workflow INFO:
	 [Node] Running &#34;resample&#34; (&#34;nipype.interfaces.fsl.preprocess.FLIRT&#34;), a CommandLine Interface with command:
flirt -in /dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/segment/c1sub-07_ses-test_T1w.nii -ref /dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/segment/c1sub-07_ses-test_T1w.nii -out c1sub-07_ses-test_T1w_flirt.nii -omat c1sub-07_ses-test_T1w_flirt.mat -applyisoxfm 4.000000
190416-10:51:57,292 nipype.workflow INFO:
	 [Node] Running &#34;threshold_WM&#34; (&#34;nipype.interfaces.fsl.maths.Threshold&#34;), a CommandLine Interface with command:
fslmaths /dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/segment/c2sub-07_ses-test_T1w.nii -thr 0.5000000000 -bin /dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/threshold_WM/c2sub-07_ses-test_T1w_thresh.nii
190416-10:51:59,105 nipype.workflow INFO:
	 [MultiProc] Running 2 tasks, and 0 jobs ready. Free memory (GB): 55.98/56.38, Free processors: 2/4.
                     Currently running:
                       * work_preproc.threshold_WM
                       * work_preproc.resample
190416-10:52:04,325 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.resample&#34;.
190416-10:52:05,108 nipype.workflow INFO:
	 [Job 8] Completed (work_preproc.resample).
190416-10:52:05,113 nipype.workflow INFO:
	 [MultiProc] Running 1 tasks, and 1 jobs ready. Free memory (GB): 56.18/56.38, Free processors: 3/4.
                     Currently running:
                       * work_preproc.threshold_WM
190416-10:52:05,231 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.mask_GM&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/mask_GM&#34;.
190416-10:52:05,298 nipype.workflow INFO:
	 [Node] Running &#34;mask_GM&#34; (&#34;nipype.interfaces.fsl.maths.Threshold&#34;), a CommandLine Interface with command:
fslmaths /dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/resample/c1sub-07_ses-test_T1w_flirt.nii -thr 0.5000000000 -bin -dilF /dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/mask_GM/c1sub-07_ses-test_T1w_flirt_thresh.nii
190416-10:52:06,372 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.mask_GM&#34;.
190416-10:52:07,110 nipype.workflow INFO:
	 [Job 9] Completed (work_preproc.mask_GM).
190416-10:52:07,115 nipype.workflow INFO:
	 [MultiProc] Running 1 tasks, and 0 jobs ready. Free memory (GB): 56.18/56.38, Free processors: 3/4.
                     Currently running:
                       * work_preproc.threshold_WM
190416-10:52:09,801 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.threshold_WM&#34;.
190416-10:52:11,114 nipype.workflow INFO:
	 [Job 10] Completed (work_preproc.threshold_WM).
190416-10:52:11,119 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 1 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 4/4.
190416-10:52:11,249 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.coreg&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/coreg&#34;.
190416-10:52:11,306 nipype.workflow INFO:
	 [Node] Running &#34;coreg&#34; (&#34;nipype.interfaces.fsl.preprocess.FLIRT&#34;), a CommandLine Interface with command:
flirt -in /dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/mcflirt/asub-07_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz_mean_reg.nii.gz -ref /dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/gunzip_anat/sub-07_ses-test_T1w.nii -out asub-07_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz_mean_reg_flirt.nii -omat asub-07_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz_mean_reg_flirt.mat -cost bbr -dof 6 -schedule /optnfs/el7/fsl/5.0.10/etc/flirtsch/bbr.sch -wmseg /dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/threshold_WM/c2sub-07_ses-test_T1w_thresh.nii
190416-10:52:13,118 nipype.workflow INFO:
	 [MultiProc] Running 1 tasks, and 0 jobs ready. Free memory (GB): 56.18/56.38, Free processors: 3/4.
                     Currently running:
                       * work_preproc.coreg
190416-10:54:56,754 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.coreg&#34;.
190416-10:54:57,282 nipype.workflow INFO:
	 [Job 11] Completed (work_preproc.coreg).
190416-10:54:57,288 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 1 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 4/4.
190416-10:54:57,439 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.applywarp&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/applywarp&#34;.
190416-10:54:57,495 nipype.workflow INFO:
	 [Node] Running &#34;applywarp&#34; (&#34;nipype.interfaces.fsl.preprocess.FLIRT&#34;), a CommandLine Interface with command:
flirt -in /dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/mcflirt/asub-07_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz -ref /dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/gunzip_anat/sub-07_ses-test_T1w.nii -out asub-07_ses-test_task-fingerfootlips_bold_roi_mcf_flirt.nii -omat asub-07_ses-test_task-fingerfootlips_bold_roi_mcf_flirt.mat -applyisoxfm 4.000000 -init /dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/coreg/asub-07_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz_mean_reg_flirt.mat -interp spline
190416-10:54:59,285 nipype.workflow INFO:
	 [MultiProc] Running 1 tasks, and 0 jobs ready. Free memory (GB): 56.18/56.38, Free processors: 3/4.
                     Currently running:
                       * work_preproc.applywarp
190416-10:55:35,680 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.applywarp&#34;.
190416-10:55:37,324 nipype.workflow INFO:
	 [Job 12] Completed (work_preproc.applywarp).
190416-10:55:37,329 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 4/4.
190416-10:55:37,463 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.susan.mask&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/susan/_subject_id_07/mask&#34;.
190416-10:55:37,475 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.susan.median&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/susan/_subject_id_07/median&#34;.
190416-10:55:37,559 nipype.workflow INFO:
	 [Node] Setting-up &#34;_median0&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/susan/_subject_id_07/median/mapflow/_median0&#34;.
190416-10:55:37,561 nipype.workflow INFO:
	 [Node] Setting-up &#34;_mask0&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/susan/_subject_id_07/mask/mapflow/_mask0&#34;.
190416-10:55:37,631 nipype.workflow INFO:
	 [Node] Running &#34;_mask0&#34; (&#34;nipype.interfaces.fsl.utils.ImageMaths&#34;), a CommandLine Interface with command:
fslmaths /dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/applywarp/asub-07_ses-test_task-fingerfootlips_bold_roi_mcf_flirt.nii -mas /dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/mask_GM/c1sub-07_ses-test_T1w_flirt_thresh.nii /dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/susan/_subject_id_07/mask/mapflow/_mask0/asub-07_ses-test_task-fingerfootlips_bold_roi_mcf_flirt_mask.nii.gz
190416-10:55:37,634 nipype.workflow INFO:
	 [Node] Running &#34;_median0&#34; (&#34;nipype.interfaces.fsl.utils.ImageStats&#34;), a CommandLine Interface with command:
fslstats /dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/applywarp/asub-07_ses-test_task-fingerfootlips_bold_roi_mcf_flirt.nii -k /dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/mask_GM/c1sub-07_ses-test_T1w_flirt_thresh.nii -p 50 
190416-10:55:39,327 nipype.workflow INFO:
	 [MultiProc] Running 2 tasks, and 0 jobs ready. Free memory (GB): 55.98/56.38, Free processors: 2/4.
                     Currently running:
                       * work_preproc.susan.median
                       * work_preproc.susan.mask
190416-10:55:39,887 nipype.workflow INFO:
	 [Node] Finished &#34;_median0&#34;.
190416-10:55:39,929 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.susan.median&#34;.
190416-10:55:41,327 nipype.workflow INFO:
	 [Job 15] Completed (work_preproc.susan.median).
190416-10:55:41,333 nipype.workflow INFO:
	 [MultiProc] Running 1 tasks, and 0 jobs ready. Free memory (GB): 56.18/56.38, Free processors: 3/4.
                     Currently running:
                       * work_preproc.susan.mask
190416-10:55:46,899 nipype.workflow INFO:
	 [Node] Finished &#34;_mask0&#34;.
190416-10:55:46,927 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.susan.mask&#34;.
190416-10:55:47,334 nipype.workflow INFO:
	 [Job 13] Completed (work_preproc.susan.mask).
190416-10:55:47,339 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 1 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 4/4.
190416-10:55:47,462 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.susan.meanfunc2&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/susan/_subject_id_07/meanfunc2&#34;.
190416-10:55:47,518 nipype.workflow INFO:
	 [Node] Setting-up &#34;_meanfunc20&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/susan/_subject_id_07/meanfunc2/mapflow/_meanfunc20&#34;.
190416-10:55:47,575 nipype.workflow INFO:
	 [Node] Running &#34;_meanfunc20&#34; (&#34;nipype.interfaces.fsl.utils.ImageMaths&#34;), a CommandLine Interface with command:
fslmaths /dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/susan/_subject_id_07/mask/mapflow/_mask0/asub-07_ses-test_task-fingerfootlips_bold_roi_mcf_flirt_mask.nii.gz -Tmean /dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/susan/_subject_id_07/meanfunc2/mapflow/_meanfunc20/asub-07_ses-test_task-fingerfootlips_bold_roi_mcf_flirt_mask_mean.nii.gz
190416-10:55:49,337 nipype.workflow INFO:
	 [MultiProc] Running 1 tasks, and 0 jobs ready. Free memory (GB): 56.18/56.38, Free processors: 3/4.
                     Currently running:
                       * work_preproc.susan.meanfunc2
190416-10:55:50,388 nipype.workflow INFO:
	 [Node] Finished &#34;_meanfunc20&#34;.
190416-10:55:50,442 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.susan.meanfunc2&#34;.
190416-10:55:51,338 nipype.workflow INFO:
	 [Job 14] Completed (work_preproc.susan.meanfunc2).
190416-10:55:51,343 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 1 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 4/4.
190416-10:55:51,462 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.susan.merge&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/susan/_subject_id_07/merge&#34;.
190416-10:55:51,527 nipype.workflow INFO:
	 [Node] Running &#34;merge&#34; (&#34;nipype.interfaces.utility.base.Merge&#34;)
190416-10:55:51,575 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.susan.merge&#34;.
190416-10:55:53,340 nipype.workflow INFO:
	 [Job 16] Completed (work_preproc.susan.merge).
190416-10:55:53,345 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 1 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 4/4.
190416-10:55:53,468 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.susan.multi_inputs&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/susan/_subject_id_07/multi_inputs&#34;.
190416-10:55:53,515 nipype.workflow INFO:
	 [Node] Running &#34;multi_inputs&#34; (&#34;nipype.interfaces.utility.wrappers.Function&#34;)
190416-10:55:53,563 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.susan.multi_inputs&#34;.
190416-10:55:55,342 nipype.workflow INFO:
	 [Job 17] Completed (work_preproc.susan.multi_inputs).
190416-10:55:55,347 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 1 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 4/4.
190416-10:55:55,479 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.susan.smooth&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/susan/_subject_id_07/smooth&#34;.
190416-10:55:55,530 nipype.workflow INFO:
	 [Node] Setting-up &#34;_smooth0&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/susan/_subject_id_07/smooth/mapflow/_smooth0&#34;.
190416-10:55:55,594 nipype.workflow INFO:
	 [Node] Running &#34;_smooth0&#34; (&#34;nipype.interfaces.fsl.preprocess.SUSAN&#34;), a CommandLine Interface with command:
susan /dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/applywarp/asub-07_ses-test_task-fingerfootlips_bold_roi_mcf_flirt.nii 1046.2500000000 1.6986436006 3 1 1 /dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/susan/_subject_id_07/meanfunc2/mapflow/_meanfunc20/asub-07_ses-test_task-fingerfootlips_bold_roi_mcf_flirt_mask_mean.nii.gz 1046.2500000000 /dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/susan/_subject_id_07/smooth/mapflow/_smooth0/asub-07_ses-test_task-fingerfootlips_bold_roi_mcf_flirt_smooth.nii.gz
190416-10:55:57,345 nipype.workflow INFO:
	 [MultiProc] Running 1 tasks, and 0 jobs ready. Free memory (GB): 56.18/56.38, Free processors: 3/4.
                     Currently running:
                       * work_preproc.susan.smooth
190416-10:57:19,545 nipype.workflow INFO:
	 [Node] Finished &#34;_smooth0&#34;.
190416-10:57:19,595 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.susan.smooth&#34;.
190416-10:57:21,429 nipype.workflow INFO:
	 [Job 18] Completed (work_preproc.susan.smooth).
190416-10:57:21,434 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 1 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 4/4.
190416-10:57:21,563 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.mask_func&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/mask_func&#34;.
190416-10:57:21,616 nipype.workflow INFO:
	 [Node] Setting-up &#34;_mask_func0&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/mask_func/mapflow/_mask_func0&#34;.
190416-10:57:21,673 nipype.workflow INFO:
	 [Node] Running &#34;_mask_func0&#34; (&#34;nipype.interfaces.fsl.maths.ApplyMask&#34;), a CommandLine Interface with command:
fslmaths /dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/susan/_subject_id_07/smooth/mapflow/_smooth0/asub-07_ses-test_task-fingerfootlips_bold_roi_mcf_flirt_smooth.nii.gz -mas /dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/mask_GM/c1sub-07_ses-test_T1w_flirt_thresh.nii /dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/mask_func/mapflow/_mask_func0/asub-07_ses-test_task-fingerfootlips_bold_roi_mcf_flirt_smooth_masked.nii
190416-10:57:23,432 nipype.workflow INFO:
	 [MultiProc] Running 1 tasks, and 0 jobs ready. Free memory (GB): 56.18/56.38, Free processors: 3/4.
                     Currently running:
                       * work_preproc.mask_func
190416-10:58:01,229 nipype.workflow INFO:
	 [Node] Finished &#34;_mask_func0&#34;.
190416-10:58:01,271 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.mask_func&#34;.
190416-10:58:01,470 nipype.workflow INFO:
	 [Job 19] Completed (work_preproc.mask_func).
190416-10:58:01,475 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 1 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 4/4.
190416-10:58:01,590 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.detrend&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/detrend&#34;.
190416-10:58:01,648 nipype.workflow INFO:
	 [Node] Running &#34;detrend&#34; (&#34;nipype.algorithms.confounds.TSNR&#34;)
190416-10:58:03,474 nipype.workflow INFO:
	 [MultiProc] Running 1 tasks, and 0 jobs ready. Free memory (GB): 56.18/56.38, Free processors: 3/4.
                     Currently running:
                       * work_preproc.detrend
190416-10:58:14,807 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.detrend&#34;.
190416-10:58:15,485 nipype.workflow INFO:
	 [Job 20] Completed (work_preproc.detrend).
190416-10:58:15,490 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 0 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 4/4.
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;networkx.classes.digraph.DiGraph at 0x2ad265de0710&gt;</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Inspect-output">Inspect output<a class="anchor-link" href="#Inspect-output"> </a></h2><p>What did we actually do? Let's look at all the data that was created.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>tree -L <span class="m">3</span> <span class="o">{</span>join<span class="o">(</span>output_dir, <span class="s1">&#39;output/work_preproc/&#39;</span><span class="o">)}</span> -I <span class="s1">&#39;*js|*json|*pklz|_report|*dot|*html|*txt|*.m&#39;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/
|-- graph.png
|-- _subject_id_02
|   |-- applywarp
|   |   |-- asub-02_ses-test_task-fingerfootlips_bold_roi_mcf_flirt.mat
|   |   `-- asub-02_ses-test_task-fingerfootlips_bold_roi_mcf_flirt.nii
|   |-- art
|   |   `-- plot.asub-02_ses-test_task-fingerfootlips_bold_roi_mcf.svg
|   |-- coreg
|   |   |-- asub-02_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz_mean_reg_flirt.mat
|   |   `-- asub-02_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz_mean_reg_flirt.nii
|   |-- datasink
|   |-- detrend
|   |   `-- detrend.nii.gz
|   |-- extract
|   |   `-- sub-02_ses-test_task-fingerfootlips_bold_roi.nii
|   |-- gunzip_anat
|   |   `-- sub-02_ses-test_T1w.nii
|   |-- gunzip_func
|   |   `-- sub-02_ses-test_task-fingerfootlips_bold.nii
|   |-- mask_func
|   |   `-- mapflow
|   |-- mask_GM
|   |   `-- c1sub-02_ses-test_T1w_flirt_thresh.nii
|   |-- mcflirt
|   |   |-- asub-02_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz
|   |   |-- asub-02_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz_mean_reg.nii.gz
|   |   `-- asub-02_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz.par
|   |-- resample
|   |   |-- c1sub-02_ses-test_T1w_flirt.mat
|   |   `-- c1sub-02_ses-test_T1w_flirt.nii
|   |-- segment
|   |   |-- c1sub-02_ses-test_T1w.nii
|   |   |-- c2sub-02_ses-test_T1w.nii
|   |   `-- c3sub-02_ses-test_T1w.nii
|   |-- selectfiles
|   |-- slicetime
|   |   `-- asub-02_ses-test_task-fingerfootlips_bold_roi.nii
|   `-- threshold_WM
|       `-- c2sub-02_ses-test_T1w_thresh.nii
|-- _subject_id_03
|   |-- applywarp
|   |   |-- asub-03_ses-test_task-fingerfootlips_bold_roi_mcf_flirt.mat
|   |   `-- asub-03_ses-test_task-fingerfootlips_bold_roi_mcf_flirt.nii
|   |-- art
|   |   `-- plot.asub-03_ses-test_task-fingerfootlips_bold_roi_mcf.svg
|   |-- coreg
|   |   |-- asub-03_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz_mean_reg_flirt.mat
|   |   `-- asub-03_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz_mean_reg_flirt.nii
|   |-- datasink
|   |-- detrend
|   |   `-- detrend.nii.gz
|   |-- extract
|   |   `-- sub-03_ses-test_task-fingerfootlips_bold_roi.nii
|   |-- gunzip_anat
|   |   `-- sub-03_ses-test_T1w.nii
|   |-- gunzip_func
|   |   `-- sub-03_ses-test_task-fingerfootlips_bold.nii
|   |-- mask_func
|   |   `-- mapflow
|   |-- mask_GM
|   |   `-- c1sub-03_ses-test_T1w_flirt_thresh.nii
|   |-- mcflirt
|   |   |-- asub-03_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz
|   |   |-- asub-03_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz_mean_reg.nii.gz
|   |   `-- asub-03_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz.par
|   |-- resample
|   |   |-- c1sub-03_ses-test_T1w_flirt.mat
|   |   `-- c1sub-03_ses-test_T1w_flirt.nii
|   |-- segment
|   |   |-- c1sub-03_ses-test_T1w.nii
|   |   |-- c2sub-03_ses-test_T1w.nii
|   |   `-- c3sub-03_ses-test_T1w.nii
|   |-- selectfiles
|   |-- slicetime
|   |   `-- asub-03_ses-test_task-fingerfootlips_bold_roi.nii
|   `-- threshold_WM
|       `-- c2sub-03_ses-test_T1w_thresh.nii
|-- _subject_id_04
|   |-- applywarp
|   |   |-- asub-04_ses-test_task-fingerfootlips_bold_roi_mcf_flirt.mat
|   |   `-- asub-04_ses-test_task-fingerfootlips_bold_roi_mcf_flirt.nii
|   |-- art
|   |   `-- plot.asub-04_ses-test_task-fingerfootlips_bold_roi_mcf.svg
|   |-- coreg
|   |   |-- asub-04_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz_mean_reg_flirt.mat
|   |   `-- asub-04_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz_mean_reg_flirt.nii
|   |-- datasink
|   |-- detrend
|   |   `-- detrend.nii.gz
|   |-- extract
|   |   `-- sub-04_ses-test_task-fingerfootlips_bold_roi.nii
|   |-- gunzip_anat
|   |   `-- sub-04_ses-test_T1w.nii
|   |-- gunzip_func
|   |   `-- sub-04_ses-test_task-fingerfootlips_bold.nii
|   |-- mask_func
|   |   `-- mapflow
|   |-- mask_GM
|   |   `-- c1sub-04_ses-test_T1w_flirt_thresh.nii
|   |-- mcflirt
|   |   |-- asub-04_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz
|   |   |-- asub-04_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz_mean_reg.nii.gz
|   |   `-- asub-04_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz.par
|   |-- resample
|   |   |-- c1sub-04_ses-test_T1w_flirt.mat
|   |   `-- c1sub-04_ses-test_T1w_flirt.nii
|   |-- segment
|   |   |-- c1sub-04_ses-test_T1w.nii
|   |   |-- c2sub-04_ses-test_T1w.nii
|   |   `-- c3sub-04_ses-test_T1w.nii
|   |-- selectfiles
|   |-- slicetime
|   |   `-- asub-04_ses-test_task-fingerfootlips_bold_roi.nii
|   `-- threshold_WM
|       `-- c2sub-04_ses-test_T1w_thresh.nii
|-- _subject_id_07
|   |-- applywarp
|   |   |-- asub-07_ses-test_task-fingerfootlips_bold_roi_mcf_flirt.mat
|   |   `-- asub-07_ses-test_task-fingerfootlips_bold_roi_mcf_flirt.nii
|   |-- art
|   |   `-- plot.asub-07_ses-test_task-fingerfootlips_bold_roi_mcf.svg
|   |-- coreg
|   |   |-- asub-07_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz_mean_reg_flirt.mat
|   |   `-- asub-07_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz_mean_reg_flirt.nii
|   |-- datasink
|   |-- detrend
|   |   `-- detrend.nii.gz
|   |-- extract
|   |   `-- sub-07_ses-test_task-fingerfootlips_bold_roi.nii
|   |-- gunzip_anat
|   |   `-- sub-07_ses-test_T1w.nii
|   |-- gunzip_func
|   |   `-- sub-07_ses-test_task-fingerfootlips_bold.nii
|   |-- mask_func
|   |   `-- mapflow
|   |-- mask_GM
|   |   `-- c1sub-07_ses-test_T1w_flirt_thresh.nii
|   |-- mcflirt
|   |   |-- asub-07_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz
|   |   |-- asub-07_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz_mean_reg.nii.gz
|   |   `-- asub-07_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz.par
|   |-- resample
|   |   |-- c1sub-07_ses-test_T1w_flirt.mat
|   |   `-- c1sub-07_ses-test_T1w_flirt.nii
|   |-- segment
|   |   |-- c1sub-07_ses-test_T1w.nii
|   |   |-- c2sub-07_ses-test_T1w.nii
|   |   `-- c3sub-07_ses-test_T1w.nii
|   |-- selectfiles
|   |-- slicetime
|   |   `-- asub-07_ses-test_task-fingerfootlips_bold_roi.nii
|   `-- threshold_WM
|       `-- c2sub-07_ses-test_T1w_thresh.nii
|-- _subject_id_08
|   |-- applywarp
|   |   |-- asub-08_ses-test_task-fingerfootlips_bold_roi_mcf_flirt.mat
|   |   `-- asub-08_ses-test_task-fingerfootlips_bold_roi_mcf_flirt.nii
|   |-- art
|   |   |-- mask.asub-08_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz
|   |   `-- plot.asub-08_ses-test_task-fingerfootlips_bold_roi_mcf.svg
|   |-- coreg
|   |   |-- asub-08_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz_mean_reg_flirt.mat
|   |   `-- asub-08_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz_mean_reg_flirt.nii
|   |-- detrend
|   |   `-- detrend.nii.gz
|   |-- extract
|   |   `-- sub-08_ses-test_task-fingerfootlips_bold_roi.nii
|   |-- gunzip_anat
|   |   `-- sub-08_ses-test_T1w.nii
|   |-- gunzip_func
|   |   `-- sub-08_ses-test_task-fingerfootlips_bold.nii
|   |-- mask_func
|   |   `-- mapflow
|   |-- mask_GM
|   |   `-- c1sub-08_ses-test_T1w_flirt_thresh.nii
|   |-- mcflirt
|   |   |-- asub-08_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz
|   |   |-- asub-08_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz_mean_reg.nii.gz
|   |   `-- asub-08_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz.par
|   |-- resample
|   |   |-- c1sub-08_ses-test_T1w_flirt.mat
|   |   `-- c1sub-08_ses-test_T1w_flirt.nii
|   |-- segment
|   |   |-- c1sub-08_ses-test_T1w.nii
|   |   |-- c2sub-08_ses-test_T1w.nii
|   |   `-- c3sub-08_ses-test_T1w.nii
|   |-- selectfiles
|   |-- slicetime
|   |   `-- asub-08_ses-test_task-fingerfootlips_bold_roi.nii
|   `-- threshold_WM
|       `-- c2sub-08_ses-test_T1w_thresh.nii
|-- _subject_id_09
|   |-- applywarp
|   |   |-- asub-09_ses-test_task-fingerfootlips_bold_roi_mcf_flirt.mat
|   |   `-- asub-09_ses-test_task-fingerfootlips_bold_roi_mcf_flirt.nii
|   |-- art
|   |   `-- plot.asub-09_ses-test_task-fingerfootlips_bold_roi_mcf.svg
|   |-- coreg
|   |   |-- asub-09_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz_mean_reg_flirt.mat
|   |   `-- asub-09_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz_mean_reg_flirt.nii
|   |-- datasink
|   |-- detrend
|   |   `-- detrend.nii.gz
|   |-- extract
|   |   `-- sub-09_ses-test_task-fingerfootlips_bold_roi.nii
|   |-- gunzip_anat
|   |   `-- sub-09_ses-test_T1w.nii
|   |-- gunzip_func
|   |   `-- sub-09_ses-test_task-fingerfootlips_bold.nii
|   |-- mask_func
|   |   `-- mapflow
|   |-- mask_GM
|   |   `-- c1sub-09_ses-test_T1w_flirt_thresh.nii
|   |-- mcflirt
|   |   |-- asub-09_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz
|   |   |-- asub-09_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz_mean_reg.nii.gz
|   |   `-- asub-09_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz.par
|   |-- resample
|   |   |-- c1sub-09_ses-test_T1w_flirt.mat
|   |   `-- c1sub-09_ses-test_T1w_flirt.nii
|   |-- segment
|   |   |-- c1sub-09_ses-test_T1w.nii
|   |   |-- c2sub-09_ses-test_T1w.nii
|   |   `-- c3sub-09_ses-test_T1w.nii
|   |-- selectfiles
|   |-- slicetime
|   |   `-- asub-09_ses-test_task-fingerfootlips_bold_roi.nii
|   `-- threshold_WM
|       `-- c2sub-09_ses-test_T1w_thresh.nii
`-- susan
    |-- _subject_id_02
    |   |-- mask
    |   |-- meanfunc2
    |   |-- median
    |   |-- merge
    |   |-- multi_inputs
    |   `-- smooth
    |-- _subject_id_03
    |   |-- mask
    |   |-- meanfunc2
    |   |-- median
    |   |-- merge
    |   |-- multi_inputs
    |   `-- smooth
    |-- _subject_id_04
    |   |-- mask
    |   |-- meanfunc2
    |   |-- median
    |   |-- merge
    |   |-- multi_inputs
    |   `-- smooth
    |-- _subject_id_07
    |   |-- mask
    |   |-- meanfunc2
    |   |-- median
    |   |-- merge
    |   |-- multi_inputs
    |   `-- smooth
    |-- _subject_id_08
    |   |-- mask
    |   |-- meanfunc2
    |   |-- median
    |   |-- merge
    |   |-- multi_inputs
    |   `-- smooth
    `-- _subject_id_09
        |-- mask
        |-- meanfunc2
        |-- median
        |-- merge
        |-- multi_inputs
        `-- smooth

150 directories, 122 files
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>But what did we do specifically? Well, let's investigate.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Motion-Correction-and-Artifact-Detection">Motion Correction and Artifact Detection<a class="anchor-link" href="#Motion-Correction-and-Artifact-Detection"> </a></h3><p>How much did the subject move in the scanner and where there any outliers in the functional images?</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Plot the motion paramters</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">par</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;output/work_preproc/_subject_id_07/mcflirt/&#39;</span>
                 <span class="s1">&#39;asub-07_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz.par&#39;</span><span class="p">))</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;rotation (radians)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">par</span><span class="p">[</span><span class="mi">0</span><span class="p">:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">par</span><span class="p">[</span><span class="mi">0</span><span class="p">:,</span> <span class="mi">3</span><span class="p">:])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time (TR)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;translation (mm)&#39;</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../../images/features/notebooks/7_Nipype_Preprocessing_114_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The motion parameters seems to look ok. What about the detection of artifacts?</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Showing the artifact detection output</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">SVG</span>
<span class="n">SVG</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;output/work_preproc/_subject_id_07/art/&#39;</span><span class="p">,</span>
    <span class="s1">&#39;plot.asub-07_ses-test_task-fingerfootlips_bold_roi_mcf.svg&#39;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">


<div class="output_svg output_subarea output_execute_result">
<svg height="288pt" version="1.1" viewBox="0 0 432 288" width="432pt" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
 <defs>
  <style type="text/css">
*{stroke-linecap:butt;stroke-linejoin:round;}
  </style>
 </defs>
 <g id="figure_1">
  <g id="patch_1">
   <path d="M 0 288  L 432 288  L 432 0  L 0 0  z " style="fill:#ffffff;"/>
  </g>
  <g id="axes_1">
   <g id="patch_2">
    <path d="M 54 133.396364  L 388.8 133.396364  L 388.8 34.56  L 54 34.56  z " style="fill:#ffffff;"/>
   </g>
   <g id="matplotlib.axis_1">
    <g id="xtick_1">
     <g id="line2d_1">
      <defs>
       <path d="M 0 0  L 0 3.5  " id="m8c9d6fddd1" style="stroke:#000000;stroke-width:0.8;"/>
      </defs>
      <g>
       <use style="stroke:#000000;stroke-width:0.8;" x="54" xlink:href="#m8c9d6fddd1" y="133.396364"/>
      </g>
     </g>
     <g id="text_1">
      <!-- 0 -->
      <defs>
       <path d="M 31.78125 66.40625  Q 24.171875 66.40625 20.328125 58.90625  Q 16.5 51.421875 16.5 36.375  Q 16.5 21.390625 20.328125 13.890625  Q 24.171875 6.390625 31.78125 6.390625  Q 39.453125 6.390625 43.28125 13.890625  Q 47.125 21.390625 47.125 36.375  Q 47.125 51.421875 43.28125 58.90625  Q 39.453125 66.40625 31.78125 66.40625  z M 31.78125 74.21875  Q 44.046875 74.21875 50.515625 64.515625  Q 56.984375 54.828125 56.984375 36.375  Q 56.984375 17.96875 50.515625 8.265625  Q 44.046875 -1.421875 31.78125 -1.421875  Q 19.53125 -1.421875 13.0625 8.265625  Q 6.59375 17.96875 6.59375 36.375  Q 6.59375 54.828125 13.0625 64.515625  Q 19.53125 74.21875 31.78125 74.21875  z " id="DejaVuSans-48"/>
      </defs>
      <g transform="translate(50.81875 147.994801)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-48"/>
      </g>
     </g>
    </g>
    <g id="xtick_2">
     <g id="line2d_2">
      <g>
       <use style="stroke:#000000;stroke-width:0.8;" x="91.407821" xlink:href="#m8c9d6fddd1" y="133.396364"/>
      </g>
     </g>
     <g id="text_2">
      <!-- 20 -->
      <defs>
       <path d="M 19.1875 8.296875  L 53.609375 8.296875  L 53.609375 0  L 7.328125 0  L 7.328125 8.296875  Q 12.9375 14.109375 22.625 23.890625  Q 32.328125 33.6875 34.8125 36.53125  Q 39.546875 41.84375 41.421875 45.53125  Q 43.3125 49.21875 43.3125 52.78125  Q 43.3125 58.59375 39.234375 62.25  Q 35.15625 65.921875 28.609375 65.921875  Q 23.96875 65.921875 18.8125 64.3125  Q 13.671875 62.703125 7.8125 59.421875  L 7.8125 69.390625  Q 13.765625 71.78125 18.9375 73  Q 24.125 74.21875 28.421875 74.21875  Q 39.75 74.21875 46.484375 68.546875  Q 53.21875 62.890625 53.21875 53.421875  Q 53.21875 48.921875 51.53125 44.890625  Q 49.859375 40.875 45.40625 35.40625  Q 44.1875 33.984375 37.640625 27.21875  Q 31.109375 20.453125 19.1875 8.296875  z " id="DejaVuSans-50"/>
      </defs>
      <g transform="translate(85.045321 147.994801)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-50"/>
       <use x="63.623047" xlink:href="#DejaVuSans-48"/>
      </g>
     </g>
    </g>
    <g id="xtick_3">
     <g id="line2d_3">
      <g>
       <use style="stroke:#000000;stroke-width:0.8;" x="128.815642" xlink:href="#m8c9d6fddd1" y="133.396364"/>
      </g>
     </g>
     <g id="text_3">
      <!-- 40 -->
      <defs>
       <path d="M 37.796875 64.3125  L 12.890625 25.390625  L 37.796875 25.390625  z M 35.203125 72.90625  L 47.609375 72.90625  L 47.609375 25.390625  L 58.015625 25.390625  L 58.015625 17.1875  L 47.609375 17.1875  L 47.609375 0  L 37.796875 0  L 37.796875 17.1875  L 4.890625 17.1875  L 4.890625 26.703125  z " id="DejaVuSans-52"/>
      </defs>
      <g transform="translate(122.453142 147.994801)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-52"/>
       <use x="63.623047" xlink:href="#DejaVuSans-48"/>
      </g>
     </g>
    </g>
    <g id="xtick_4">
     <g id="line2d_4">
      <g>
       <use style="stroke:#000000;stroke-width:0.8;" x="166.223464" xlink:href="#m8c9d6fddd1" y="133.396364"/>
      </g>
     </g>
     <g id="text_4">
      <!-- 60 -->
      <defs>
       <path d="M 33.015625 40.375  Q 26.375 40.375 22.484375 35.828125  Q 18.609375 31.296875 18.609375 23.390625  Q 18.609375 15.53125 22.484375 10.953125  Q 26.375 6.390625 33.015625 6.390625  Q 39.65625 6.390625 43.53125 10.953125  Q 47.40625 15.53125 47.40625 23.390625  Q 47.40625 31.296875 43.53125 35.828125  Q 39.65625 40.375 33.015625 40.375  z M 52.59375 71.296875  L 52.59375 62.3125  Q 48.875 64.0625 45.09375 64.984375  Q 41.3125 65.921875 37.59375 65.921875  Q 27.828125 65.921875 22.671875 59.328125  Q 17.53125 52.734375 16.796875 39.40625  Q 19.671875 43.65625 24.015625 45.921875  Q 28.375 48.1875 33.59375 48.1875  Q 44.578125 48.1875 50.953125 41.515625  Q 57.328125 34.859375 57.328125 23.390625  Q 57.328125 12.15625 50.6875 5.359375  Q 44.046875 -1.421875 33.015625 -1.421875  Q 20.359375 -1.421875 13.671875 8.265625  Q 6.984375 17.96875 6.984375 36.375  Q 6.984375 53.65625 15.1875 63.9375  Q 23.390625 74.21875 37.203125 74.21875  Q 40.921875 74.21875 44.703125 73.484375  Q 48.484375 72.75 52.59375 71.296875  z " id="DejaVuSans-54"/>
      </defs>
      <g transform="translate(159.860964 147.994801)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-54"/>
       <use x="63.623047" xlink:href="#DejaVuSans-48"/>
      </g>
     </g>
    </g>
    <g id="xtick_5">
     <g id="line2d_5">
      <g>
       <use style="stroke:#000000;stroke-width:0.8;" x="203.631285" xlink:href="#m8c9d6fddd1" y="133.396364"/>
      </g>
     </g>
     <g id="text_5">
      <!-- 80 -->
      <defs>
       <path d="M 31.78125 34.625  Q 24.75 34.625 20.71875 30.859375  Q 16.703125 27.09375 16.703125 20.515625  Q 16.703125 13.921875 20.71875 10.15625  Q 24.75 6.390625 31.78125 6.390625  Q 38.8125 6.390625 42.859375 10.171875  Q 46.921875 13.96875 46.921875 20.515625  Q 46.921875 27.09375 42.890625 30.859375  Q 38.875 34.625 31.78125 34.625  z M 21.921875 38.8125  Q 15.578125 40.375 12.03125 44.71875  Q 8.5 49.078125 8.5 55.328125  Q 8.5 64.0625 14.71875 69.140625  Q 20.953125 74.21875 31.78125 74.21875  Q 42.671875 74.21875 48.875 69.140625  Q 55.078125 64.0625 55.078125 55.328125  Q 55.078125 49.078125 51.53125 44.71875  Q 48 40.375 41.703125 38.8125  Q 48.828125 37.15625 52.796875 32.3125  Q 56.78125 27.484375 56.78125 20.515625  Q 56.78125 9.90625 50.3125 4.234375  Q 43.84375 -1.421875 31.78125 -1.421875  Q 19.734375 -1.421875 13.25 4.234375  Q 6.78125 9.90625 6.78125 20.515625  Q 6.78125 27.484375 10.78125 32.3125  Q 14.796875 37.15625 21.921875 38.8125  z M 18.3125 54.390625  Q 18.3125 48.734375 21.84375 45.5625  Q 25.390625 42.390625 31.78125 42.390625  Q 38.140625 42.390625 41.71875 45.5625  Q 45.3125 48.734375 45.3125 54.390625  Q 45.3125 60.0625 41.71875 63.234375  Q 38.140625 66.40625 31.78125 66.40625  Q 25.390625 66.40625 21.84375 63.234375  Q 18.3125 60.0625 18.3125 54.390625  z " id="DejaVuSans-56"/>
      </defs>
      <g transform="translate(197.268785 147.994801)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-56"/>
       <use x="63.623047" xlink:href="#DejaVuSans-48"/>
      </g>
     </g>
    </g>
    <g id="xtick_6">
     <g id="line2d_6">
      <g>
       <use style="stroke:#000000;stroke-width:0.8;" x="241.039106" xlink:href="#m8c9d6fddd1" y="133.396364"/>
      </g>
     </g>
     <g id="text_6">
      <!-- 100 -->
      <defs>
       <path d="M 12.40625 8.296875  L 28.515625 8.296875  L 28.515625 63.921875  L 10.984375 60.40625  L 10.984375 69.390625  L 28.421875 72.90625  L 38.28125 72.90625  L 38.28125 8.296875  L 54.390625 8.296875  L 54.390625 0  L 12.40625 0  z " id="DejaVuSans-49"/>
      </defs>
      <g transform="translate(231.495356 147.994801)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-49"/>
       <use x="63.623047" xlink:href="#DejaVuSans-48"/>
       <use x="127.246094" xlink:href="#DejaVuSans-48"/>
      </g>
     </g>
    </g>
    <g id="xtick_7">
     <g id="line2d_7">
      <g>
       <use style="stroke:#000000;stroke-width:0.8;" x="278.446927" xlink:href="#m8c9d6fddd1" y="133.396364"/>
      </g>
     </g>
     <g id="text_7">
      <!-- 120 -->
      <g transform="translate(268.903177 147.994801)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-49"/>
       <use x="63.623047" xlink:href="#DejaVuSans-50"/>
       <use x="127.246094" xlink:href="#DejaVuSans-48"/>
      </g>
     </g>
    </g>
    <g id="xtick_8">
     <g id="line2d_8">
      <g>
       <use style="stroke:#000000;stroke-width:0.8;" x="315.854749" xlink:href="#m8c9d6fddd1" y="133.396364"/>
      </g>
     </g>
     <g id="text_8">
      <!-- 140 -->
      <g transform="translate(306.310999 147.994801)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-49"/>
       <use x="63.623047" xlink:href="#DejaVuSans-52"/>
       <use x="127.246094" xlink:href="#DejaVuSans-48"/>
      </g>
     </g>
    </g>
    <g id="xtick_9">
     <g id="line2d_9">
      <g>
       <use style="stroke:#000000;stroke-width:0.8;" x="353.26257" xlink:href="#m8c9d6fddd1" y="133.396364"/>
      </g>
     </g>
     <g id="text_9">
      <!-- 160 -->
      <g transform="translate(343.71882 147.994801)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-49"/>
       <use x="63.623047" xlink:href="#DejaVuSans-54"/>
       <use x="127.246094" xlink:href="#DejaVuSans-48"/>
      </g>
     </g>
    </g>
    <g id="text_10">
     <!-- Scans - 0-based -->
     <defs>
      <path d="M 53.515625 70.515625  L 53.515625 60.890625  Q 47.90625 63.578125 42.921875 64.890625  Q 37.9375 66.21875 33.296875 66.21875  Q 25.25 66.21875 20.875 63.09375  Q 16.5 59.96875 16.5 54.203125  Q 16.5 49.359375 19.40625 46.890625  Q 22.3125 44.4375 30.421875 42.921875  L 36.375 41.703125  Q 47.40625 39.59375 52.65625 34.296875  Q 57.90625 29 57.90625 20.125  Q 57.90625 9.515625 50.796875 4.046875  Q 43.703125 -1.421875 29.984375 -1.421875  Q 24.8125 -1.421875 18.96875 -0.25  Q 13.140625 0.921875 6.890625 3.21875  L 6.890625 13.375  Q 12.890625 10.015625 18.65625 8.296875  Q 24.421875 6.59375 29.984375 6.59375  Q 38.421875 6.59375 43.015625 9.90625  Q 47.609375 13.234375 47.609375 19.390625  Q 47.609375 24.75 44.3125 27.78125  Q 41.015625 30.8125 33.5 32.328125  L 27.484375 33.5  Q 16.453125 35.6875 11.515625 40.375  Q 6.59375 45.0625 6.59375 53.421875  Q 6.59375 63.09375 13.40625 68.65625  Q 20.21875 74.21875 32.171875 74.21875  Q 37.3125 74.21875 42.625 73.28125  Q 47.953125 72.359375 53.515625 70.515625  z " id="DejaVuSans-83"/>
      <path d="M 48.78125 52.59375  L 48.78125 44.1875  Q 44.96875 46.296875 41.140625 47.34375  Q 37.3125 48.390625 33.40625 48.390625  Q 24.65625 48.390625 19.8125 42.84375  Q 14.984375 37.3125 14.984375 27.296875  Q 14.984375 17.28125 19.8125 11.734375  Q 24.65625 6.203125 33.40625 6.203125  Q 37.3125 6.203125 41.140625 7.25  Q 44.96875 8.296875 48.78125 10.40625  L 48.78125 2.09375  Q 45.015625 0.34375 40.984375 -0.53125  Q 36.96875 -1.421875 32.421875 -1.421875  Q 20.0625 -1.421875 12.78125 6.34375  Q 5.515625 14.109375 5.515625 27.296875  Q 5.515625 40.671875 12.859375 48.328125  Q 20.21875 56 33.015625 56  Q 37.15625 56 41.109375 55.140625  Q 45.0625 54.296875 48.78125 52.59375  z " id="DejaVuSans-99"/>
      <path d="M 34.28125 27.484375  Q 23.390625 27.484375 19.1875 25  Q 14.984375 22.515625 14.984375 16.5  Q 14.984375 11.71875 18.140625 8.90625  Q 21.296875 6.109375 26.703125 6.109375  Q 34.1875 6.109375 38.703125 11.40625  Q 43.21875 16.703125 43.21875 25.484375  L 43.21875 27.484375  z M 52.203125 31.203125  L 52.203125 0  L 43.21875 0  L 43.21875 8.296875  Q 40.140625 3.328125 35.546875 0.953125  Q 30.953125 -1.421875 24.3125 -1.421875  Q 15.921875 -1.421875 10.953125 3.296875  Q 6 8.015625 6 15.921875  Q 6 25.140625 12.171875 29.828125  Q 18.359375 34.515625 30.609375 34.515625  L 43.21875 34.515625  L 43.21875 35.40625  Q 43.21875 41.609375 39.140625 45  Q 35.0625 48.390625 27.6875 48.390625  Q 23 48.390625 18.546875 47.265625  Q 14.109375 46.140625 10.015625 43.890625  L 10.015625 52.203125  Q 14.9375 54.109375 19.578125 55.046875  Q 24.21875 56 28.609375 56  Q 40.484375 56 46.34375 49.84375  Q 52.203125 43.703125 52.203125 31.203125  z " id="DejaVuSans-97"/>
      <path d="M 54.890625 33.015625  L 54.890625 0  L 45.90625 0  L 45.90625 32.71875  Q 45.90625 40.484375 42.875 44.328125  Q 39.84375 48.1875 33.796875 48.1875  Q 26.515625 48.1875 22.3125 43.546875  Q 18.109375 38.921875 18.109375 30.90625  L 18.109375 0  L 9.078125 0  L 9.078125 54.6875  L 18.109375 54.6875  L 18.109375 46.1875  Q 21.34375 51.125 25.703125 53.5625  Q 30.078125 56 35.796875 56  Q 45.21875 56 50.046875 50.171875  Q 54.890625 44.34375 54.890625 33.015625  z " id="DejaVuSans-110"/>
      <path d="M 44.28125 53.078125  L 44.28125 44.578125  Q 40.484375 46.53125 36.375 47.5  Q 32.28125 48.484375 27.875 48.484375  Q 21.1875 48.484375 17.84375 46.4375  Q 14.5 44.390625 14.5 40.28125  Q 14.5 37.15625 16.890625 35.375  Q 19.28125 33.59375 26.515625 31.984375  L 29.59375 31.296875  Q 39.15625 29.25 43.1875 25.515625  Q 47.21875 21.78125 47.21875 15.09375  Q 47.21875 7.46875 41.1875 3.015625  Q 35.15625 -1.421875 24.609375 -1.421875  Q 20.21875 -1.421875 15.453125 -0.5625  Q 10.6875 0.296875 5.421875 2  L 5.421875 11.28125  Q 10.40625 8.6875 15.234375 7.390625  Q 20.0625 6.109375 24.8125 6.109375  Q 31.15625 6.109375 34.5625 8.28125  Q 37.984375 10.453125 37.984375 14.40625  Q 37.984375 18.0625 35.515625 20.015625  Q 33.0625 21.96875 24.703125 23.78125  L 21.578125 24.515625  Q 13.234375 26.265625 9.515625 29.90625  Q 5.8125 33.546875 5.8125 39.890625  Q 5.8125 47.609375 11.28125 51.796875  Q 16.75 56 26.8125 56  Q 31.78125 56 36.171875 55.265625  Q 40.578125 54.546875 44.28125 53.078125  z " id="DejaVuSans-115"/>
      <path id="DejaVuSans-32"/>
      <path d="M 4.890625 31.390625  L 31.203125 31.390625  L 31.203125 23.390625  L 4.890625 23.390625  z " id="DejaVuSans-45"/>
      <path d="M 48.6875 27.296875  Q 48.6875 37.203125 44.609375 42.84375  Q 40.53125 48.484375 33.40625 48.484375  Q 26.265625 48.484375 22.1875 42.84375  Q 18.109375 37.203125 18.109375 27.296875  Q 18.109375 17.390625 22.1875 11.75  Q 26.265625 6.109375 33.40625 6.109375  Q 40.53125 6.109375 44.609375 11.75  Q 48.6875 17.390625 48.6875 27.296875  z M 18.109375 46.390625  Q 20.953125 51.265625 25.265625 53.625  Q 29.59375 56 35.59375 56  Q 45.5625 56 51.78125 48.09375  Q 58.015625 40.1875 58.015625 27.296875  Q 58.015625 14.40625 51.78125 6.484375  Q 45.5625 -1.421875 35.59375 -1.421875  Q 29.59375 -1.421875 25.265625 0.953125  Q 20.953125 3.328125 18.109375 8.203125  L 18.109375 0  L 9.078125 0  L 9.078125 75.984375  L 18.109375 75.984375  z " id="DejaVuSans-98"/>
      <path d="M 56.203125 29.59375  L 56.203125 25.203125  L 14.890625 25.203125  Q 15.484375 15.921875 20.484375 11.0625  Q 25.484375 6.203125 34.421875 6.203125  Q 39.59375 6.203125 44.453125 7.46875  Q 49.3125 8.734375 54.109375 11.28125  L 54.109375 2.78125  Q 49.265625 0.734375 44.1875 -0.34375  Q 39.109375 -1.421875 33.890625 -1.421875  Q 20.796875 -1.421875 13.15625 6.1875  Q 5.515625 13.8125 5.515625 26.8125  Q 5.515625 40.234375 12.765625 48.109375  Q 20.015625 56 32.328125 56  Q 43.359375 56 49.78125 48.890625  Q 56.203125 41.796875 56.203125 29.59375  z M 47.21875 32.234375  Q 47.125 39.59375 43.09375 43.984375  Q 39.0625 48.390625 32.421875 48.390625  Q 24.90625 48.390625 20.390625 44.140625  Q 15.875 39.890625 15.1875 32.171875  z " id="DejaVuSans-101"/>
      <path d="M 45.40625 46.390625  L 45.40625 75.984375  L 54.390625 75.984375  L 54.390625 0  L 45.40625 0  L 45.40625 8.203125  Q 42.578125 3.328125 38.25 0.953125  Q 33.9375 -1.421875 27.875 -1.421875  Q 17.96875 -1.421875 11.734375 6.484375  Q 5.515625 14.40625 5.515625 27.296875  Q 5.515625 40.1875 11.734375 48.09375  Q 17.96875 56 27.875 56  Q 33.9375 56 38.25 53.625  Q 42.578125 51.265625 45.40625 46.390625  z M 14.796875 27.296875  Q 14.796875 17.390625 18.875 11.75  Q 22.953125 6.109375 30.078125 6.109375  Q 37.203125 6.109375 41.296875 11.75  Q 45.40625 17.390625 45.40625 27.296875  Q 45.40625 37.203125 41.296875 42.84375  Q 37.203125 48.484375 30.078125 48.484375  Q 22.953125 48.484375 18.875 42.84375  Q 14.796875 37.203125 14.796875 27.296875  z " id="DejaVuSans-100"/>
     </defs>
     <g transform="translate(181.578125 161.672926)scale(0.1 -0.1)">
      <use xlink:href="#DejaVuSans-83"/>
      <use x="63.476562" xlink:href="#DejaVuSans-99"/>
      <use x="118.457031" xlink:href="#DejaVuSans-97"/>
      <use x="179.736328" xlink:href="#DejaVuSans-110"/>
      <use x="243.115234" xlink:href="#DejaVuSans-115"/>
      <use x="295.214844" xlink:href="#DejaVuSans-32"/>
      <use x="327.001953" xlink:href="#DejaVuSans-45"/>
      <use x="363.085938" xlink:href="#DejaVuSans-32"/>
      <use x="394.873047" xlink:href="#DejaVuSans-48"/>
      <use x="458.496094" xlink:href="#DejaVuSans-45"/>
      <use x="494.580078" xlink:href="#DejaVuSans-98"/>
      <use x="558.056641" xlink:href="#DejaVuSans-97"/>
      <use x="619.335938" xlink:href="#DejaVuSans-115"/>
      <use x="671.435547" xlink:href="#DejaVuSans-101"/>
      <use x="732.958984" xlink:href="#DejaVuSans-100"/>
     </g>
    </g>
   </g>
   <g id="matplotlib.axis_2">
    <g id="ytick_1">
     <g id="line2d_10">
      <defs>
       <path d="M 0 0  L -3.5 0  " id="m5e88bef2aa" style="stroke:#000000;stroke-width:0.8;"/>
      </defs>
      <g>
       <use style="stroke:#000000;stroke-width:0.8;" x="54" xlink:href="#m5e88bef2aa" y="116.48348"/>
      </g>
     </g>
     <g id="text_11">
      <!-- −2 -->
      <defs>
       <path d="M 10.59375 35.5  L 73.1875 35.5  L 73.1875 27.203125  L 10.59375 27.203125  z " id="DejaVuSans-8722"/>
      </defs>
      <g transform="translate(32.257812 120.282698)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-8722"/>
       <use x="83.789062" xlink:href="#DejaVuSans-50"/>
      </g>
     </g>
    </g>
    <g id="ytick_2">
     <g id="line2d_11">
      <g>
       <use style="stroke:#000000;stroke-width:0.8;" x="54" xlink:href="#m5e88bef2aa" y="79.638369"/>
      </g>
     </g>
     <g id="text_12">
      <!-- 0 -->
      <g transform="translate(40.6375 83.437588)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-48"/>
      </g>
     </g>
    </g>
    <g id="ytick_3">
     <g id="line2d_12">
      <g>
       <use style="stroke:#000000;stroke-width:0.8;" x="54" xlink:href="#m5e88bef2aa" y="42.793259"/>
      </g>
     </g>
     <g id="text_13">
      <!-- 2 -->
      <g transform="translate(40.6375 46.592478)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-50"/>
      </g>
     </g>
    </g>
    <g id="text_14">
     <!-- Intensity -->
     <defs>
      <path d="M 9.8125 72.90625  L 19.671875 72.90625  L 19.671875 0  L 9.8125 0  z " id="DejaVuSans-73"/>
      <path d="M 18.3125 70.21875  L 18.3125 54.6875  L 36.8125 54.6875  L 36.8125 47.703125  L 18.3125 47.703125  L 18.3125 18.015625  Q 18.3125 11.328125 20.140625 9.421875  Q 21.96875 7.515625 27.59375 7.515625  L 36.8125 7.515625  L 36.8125 0  L 27.59375 0  Q 17.1875 0 13.234375 3.875  Q 9.28125 7.765625 9.28125 18.015625  L 9.28125 47.703125  L 2.6875 47.703125  L 2.6875 54.6875  L 9.28125 54.6875  L 9.28125 70.21875  z " id="DejaVuSans-116"/>
      <path d="M 9.421875 54.6875  L 18.40625 54.6875  L 18.40625 0  L 9.421875 0  z M 9.421875 75.984375  L 18.40625 75.984375  L 18.40625 64.59375  L 9.421875 64.59375  z " id="DejaVuSans-105"/>
      <path d="M 32.171875 -5.078125  Q 28.375 -14.84375 24.75 -17.8125  Q 21.140625 -20.796875 15.09375 -20.796875  L 7.90625 -20.796875  L 7.90625 -13.28125  L 13.1875 -13.28125  Q 16.890625 -13.28125 18.9375 -11.515625  Q 21 -9.765625 23.484375 -3.21875  L 25.09375 0.875  L 2.984375 54.6875  L 12.5 54.6875  L 29.59375 11.921875  L 46.6875 54.6875  L 56.203125 54.6875  z " id="DejaVuSans-121"/>
     </defs>
     <g transform="translate(26.178125 105.740682)rotate(-90)scale(0.1 -0.1)">
      <use xlink:href="#DejaVuSans-73"/>
      <use x="29.492188" xlink:href="#DejaVuSans-110"/>
      <use x="92.871094" xlink:href="#DejaVuSans-116"/>
      <use x="132.080078" xlink:href="#DejaVuSans-101"/>
      <use x="193.603516" xlink:href="#DejaVuSans-110"/>
      <use x="256.982422" xlink:href="#DejaVuSans-115"/>
      <use x="309.082031" xlink:href="#DejaVuSans-105"/>
      <use x="336.865234" xlink:href="#DejaVuSans-116"/>
      <use x="376.074219" xlink:href="#DejaVuSans-121"/>
     </g>
    </g>
   </g>
   <g id="line2d_13">
    <path clip-path="url(#p8b93139267)" d="M 54 85.597732  L 55.870391 75.23669  L 57.740782 61.03796  L 59.611173 67.278533  L 61.481564 83.908964  L 63.351955 66.30592  L 65.222346 52.835933  L 67.092737 57.315409  L 68.963128 46.997878  L 70.83352 42.315741  L 74.574302 79.73956  L 76.444693 87.544189  L 78.315084 72.702203  L 82.055866 92.799498  L 83.926257 88.55246  L 85.796648 76.906056  L 87.667039 74.943383  L 89.53743 75.291719  L 91.407821 56.591728  L 93.278212 39.915425  L 95.148603 49.198625  L 97.018994 60.930262  L 98.889385 88.026261  L 100.759777 83.574899  L 102.630168 93.100182  L 104.500559 97.285631  L 106.37095 87.597364  L 108.241341 83.822418  L 110.111732 72.452981  L 111.982123 65.88631  L 113.852514 57.516757  L 115.722905 56.165906  L 117.593296 47.950267  L 119.463687 63.011849  L 121.334078 84.900078  L 123.204469 79.519482  L 125.07486 72.28042  L 126.945251 81.640672  L 128.815642 80.563723  L 130.686034 80.366556  L 132.556425 90.519953  L 134.426816 73.82985  L 136.297207 80.34145  L 138.167598 82.268984  L 140.037989 96.073379  L 141.90838 100.055846  L 143.778771 89.715122  L 145.649162 52.294181  L 147.519553 57.264533  L 149.389944 54.177504  L 151.260335 63.744955  L 153.130726 65.857646  L 155.001117 68.760032  L 156.871508 83.321538  L 158.741899 105.483859  L 160.612291 101.949464  L 162.482682 99.799334  L 164.353073 99.500389  L 166.223464 103.412319  L 168.093855 90.855465  L 169.964246 80.896938  L 171.834637 82.268236  L 173.705028 97.172838  L 175.575419 95.281851  L 177.44581 71.260618  L 179.316201 54.656385  L 181.186592 70.615958  L 183.056983 88.679723  L 184.927374 104.116219  L 186.797765 92.005581  L 188.668156 106.682475  L 190.538547 112.490632  L 192.408939 99.730796  L 194.27933 100.355525  L 196.149721 110.184994  L 198.020112 105.837327  L 199.890503 81.082559  L 201.760894 88.60332  L 203.631285 80.085987  L 205.501676 83.882146  L 207.372067 95.684511  L 209.242458 91.290268  L 211.112849 95.385822  L 212.98324 77.085661  L 214.853631 81.078287  L 216.724022 88.296587  L 218.594413 75.619745  L 220.464804 59.175751  L 222.335196 89.879622  L 224.205587 104.414677  L 226.075978 112.300384  L 227.946369 105.955479  L 229.81676 115.523313  L 231.687151 133.396364  L 233.557542 125.807497  L 235.427933 103.575728  L 237.298324 89.648983  L 239.168715 100.577508  L 241.039106 86.540359  L 242.909497 79.608358  L 244.779888 65.31705  L 246.650279 59.669453  L 248.52067 45.637863  L 250.391061 40.830563  L 252.261453 63.705527  L 254.131844 80.687486  L 256.002235 78.414686  L 257.872626 72.464437  L 259.743017 64.337734  L 261.613408 82.820881  L 263.483799 84.048616  L 265.35419 88.115227  L 267.224581 82.367577  L 269.094972 95.425787  L 270.965363 98.517355  L 272.835754 101.17689  L 274.706145 96.735687  L 276.576536 107.476755  L 278.446927 122.544088  L 280.317318 94.700884  L 282.187709 88.019975  L 284.058101 90.604374  L 285.928492 98.460372  L 287.798883 96.259833  L 291.539665 45.032901  L 293.410056 85.941664  L 295.280447 100.093564  L 297.150838 80.548867  L 299.021229 80.306848  L 300.89162 85.137662  L 302.762011 107.500474  L 304.632402 90.713384  L 306.502793 84.041867  L 308.373184 93.731414  L 310.243575 80.529771  L 312.113966 87.111906  L 313.984358 76.751823  L 315.854749 54.381857  L 317.72514 34.56  L 319.595531 65.551764  L 323.336313 110.401018  L 327.077095 62.521665  L 328.947486 60.524108  L 330.817877 47.123124  L 332.688268 60.926369  L 334.558659 68.50904  L 336.42905 82.702725  L 338.299441 75.379326  L 340.169832 74.231841  L 342.040223 73.218145  L 343.910615 52.739422  L 345.781006 35.42063  L 347.651397 40.830681  L 351.392179 73.195468  L 353.26257 73.723211  L 355.132961 71.643234  L 357.003352 77.243809  L 358.873743 61.604269  L 360.744134 66.82073  L 362.614525 57.59133  L 364.484916 82.347953  L 366.355307 81.880717  L 368.225698 77.023582  L 370.096089 75.753235  L 371.96648 84.983916  L 373.836872 88.417621  L 375.707263 76.685538  L 377.577654 69.761204  L 379.448045 75.62878  L 381.318436 70.492952  L 383.188827 63.17147  L 385.059218 54.5836  L 386.929609 72.01331  L 388.8 95.721287  L 388.8 95.721287  " style="fill:none;stroke:#1f77b4;stroke-linecap:square;stroke-width:1.5;"/>
   </g>
   <g id="patch_3">
    <path d="M 54 133.396364  L 54 34.56  " style="fill:none;stroke:#000000;stroke-linecap:square;stroke-linejoin:miter;stroke-width:0.8;"/>
   </g>
   <g id="patch_4">
    <path d="M 388.8 133.396364  L 388.8 34.56  " style="fill:none;stroke:#000000;stroke-linecap:square;stroke-linejoin:miter;stroke-width:0.8;"/>
   </g>
   <g id="patch_5">
    <path d="M 54 133.396364  L 388.8 133.396364  " style="fill:none;stroke:#000000;stroke-linecap:square;stroke-linejoin:miter;stroke-width:0.8;"/>
   </g>
   <g id="patch_6">
    <path d="M 54 34.56  L 388.8 34.56  " style="fill:none;stroke:#000000;stroke-linecap:square;stroke-linejoin:miter;stroke-width:0.8;"/>
   </g>
  </g>
  <g id="axes_2">
   <g id="patch_7">
    <path d="M 54 252  L 388.8 252  L 388.8 153.163636  L 54 153.163636  z " style="fill:#ffffff;"/>
   </g>
   <g id="matplotlib.axis_3">
    <g id="xtick_10">
     <g id="line2d_14">
      <g>
       <use style="stroke:#000000;stroke-width:0.8;" x="54" xlink:href="#m8c9d6fddd1" y="252"/>
      </g>
     </g>
     <g id="text_15">
      <!-- 0 -->
      <g transform="translate(50.81875 266.598437)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-48"/>
      </g>
     </g>
    </g>
    <g id="xtick_11">
     <g id="line2d_15">
      <g>
       <use style="stroke:#000000;stroke-width:0.8;" x="91.407821" xlink:href="#m8c9d6fddd1" y="252"/>
      </g>
     </g>
     <g id="text_16">
      <!-- 20 -->
      <g transform="translate(85.045321 266.598437)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-50"/>
       <use x="63.623047" xlink:href="#DejaVuSans-48"/>
      </g>
     </g>
    </g>
    <g id="xtick_12">
     <g id="line2d_16">
      <g>
       <use style="stroke:#000000;stroke-width:0.8;" x="128.815642" xlink:href="#m8c9d6fddd1" y="252"/>
      </g>
     </g>
     <g id="text_17">
      <!-- 40 -->
      <g transform="translate(122.453142 266.598437)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-52"/>
       <use x="63.623047" xlink:href="#DejaVuSans-48"/>
      </g>
     </g>
    </g>
    <g id="xtick_13">
     <g id="line2d_17">
      <g>
       <use style="stroke:#000000;stroke-width:0.8;" x="166.223464" xlink:href="#m8c9d6fddd1" y="252"/>
      </g>
     </g>
     <g id="text_18">
      <!-- 60 -->
      <g transform="translate(159.860964 266.598437)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-54"/>
       <use x="63.623047" xlink:href="#DejaVuSans-48"/>
      </g>
     </g>
    </g>
    <g id="xtick_14">
     <g id="line2d_18">
      <g>
       <use style="stroke:#000000;stroke-width:0.8;" x="203.631285" xlink:href="#m8c9d6fddd1" y="252"/>
      </g>
     </g>
     <g id="text_19">
      <!-- 80 -->
      <g transform="translate(197.268785 266.598437)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-56"/>
       <use x="63.623047" xlink:href="#DejaVuSans-48"/>
      </g>
     </g>
    </g>
    <g id="xtick_15">
     <g id="line2d_19">
      <g>
       <use style="stroke:#000000;stroke-width:0.8;" x="241.039106" xlink:href="#m8c9d6fddd1" y="252"/>
      </g>
     </g>
     <g id="text_20">
      <!-- 100 -->
      <g transform="translate(231.495356 266.598437)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-49"/>
       <use x="63.623047" xlink:href="#DejaVuSans-48"/>
       <use x="127.246094" xlink:href="#DejaVuSans-48"/>
      </g>
     </g>
    </g>
    <g id="xtick_16">
     <g id="line2d_20">
      <g>
       <use style="stroke:#000000;stroke-width:0.8;" x="278.446927" xlink:href="#m8c9d6fddd1" y="252"/>
      </g>
     </g>
     <g id="text_21">
      <!-- 120 -->
      <g transform="translate(268.903177 266.598437)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-49"/>
       <use x="63.623047" xlink:href="#DejaVuSans-50"/>
       <use x="127.246094" xlink:href="#DejaVuSans-48"/>
      </g>
     </g>
    </g>
    <g id="xtick_17">
     <g id="line2d_21">
      <g>
       <use style="stroke:#000000;stroke-width:0.8;" x="315.854749" xlink:href="#m8c9d6fddd1" y="252"/>
      </g>
     </g>
     <g id="text_22">
      <!-- 140 -->
      <g transform="translate(306.310999 266.598437)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-49"/>
       <use x="63.623047" xlink:href="#DejaVuSans-52"/>
       <use x="127.246094" xlink:href="#DejaVuSans-48"/>
      </g>
     </g>
    </g>
    <g id="xtick_18">
     <g id="line2d_22">
      <g>
       <use style="stroke:#000000;stroke-width:0.8;" x="353.26257" xlink:href="#m8c9d6fddd1" y="252"/>
      </g>
     </g>
     <g id="text_23">
      <!-- 160 -->
      <g transform="translate(343.71882 266.598437)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-49"/>
       <use x="63.623047" xlink:href="#DejaVuSans-54"/>
       <use x="127.246094" xlink:href="#DejaVuSans-48"/>
      </g>
     </g>
    </g>
    <g id="text_24">
     <!-- Scans - 0-based -->
     <g transform="translate(181.578125 280.276562)scale(0.1 -0.1)">
      <use xlink:href="#DejaVuSans-83"/>
      <use x="63.476562" xlink:href="#DejaVuSans-99"/>
      <use x="118.457031" xlink:href="#DejaVuSans-97"/>
      <use x="179.736328" xlink:href="#DejaVuSans-110"/>
      <use x="243.115234" xlink:href="#DejaVuSans-115"/>
      <use x="295.214844" xlink:href="#DejaVuSans-32"/>
      <use x="327.001953" xlink:href="#DejaVuSans-45"/>
      <use x="363.085938" xlink:href="#DejaVuSans-32"/>
      <use x="394.873047" xlink:href="#DejaVuSans-48"/>
      <use x="458.496094" xlink:href="#DejaVuSans-45"/>
      <use x="494.580078" xlink:href="#DejaVuSans-98"/>
      <use x="558.056641" xlink:href="#DejaVuSans-97"/>
      <use x="619.335938" xlink:href="#DejaVuSans-115"/>
      <use x="671.435547" xlink:href="#DejaVuSans-101"/>
      <use x="732.958984" xlink:href="#DejaVuSans-100"/>
     </g>
    </g>
   </g>
   <g id="matplotlib.axis_4">
    <g id="ytick_4">
     <g id="line2d_23">
      <g>
       <use style="stroke:#000000;stroke-width:0.8;" x="54" xlink:href="#m5e88bef2aa" y="252"/>
      </g>
     </g>
     <g id="text_25">
      <!-- 0.0 -->
      <defs>
       <path d="M 10.6875 12.40625  L 21 12.40625  L 21 0  L 10.6875 0  z " id="DejaVuSans-46"/>
      </defs>
      <g transform="translate(31.096875 255.799219)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-48"/>
       <use x="63.623047" xlink:href="#DejaVuSans-46"/>
       <use x="95.410156" xlink:href="#DejaVuSans-48"/>
      </g>
     </g>
    </g>
    <g id="ytick_5">
     <g id="line2d_24">
      <g>
       <use style="stroke:#000000;stroke-width:0.8;" x="54" xlink:href="#m5e88bef2aa" y="225.200423"/>
      </g>
     </g>
     <g id="text_26">
      <!-- 0.2 -->
      <g transform="translate(31.096875 228.999642)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-48"/>
       <use x="63.623047" xlink:href="#DejaVuSans-46"/>
       <use x="95.410156" xlink:href="#DejaVuSans-50"/>
      </g>
     </g>
    </g>
    <g id="ytick_6">
     <g id="line2d_25">
      <g>
       <use style="stroke:#000000;stroke-width:0.8;" x="54" xlink:href="#m5e88bef2aa" y="198.400846"/>
      </g>
     </g>
     <g id="text_27">
      <!-- 0.4 -->
      <g transform="translate(31.096875 202.200065)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-48"/>
       <use x="63.623047" xlink:href="#DejaVuSans-46"/>
       <use x="95.410156" xlink:href="#DejaVuSans-52"/>
      </g>
     </g>
    </g>
    <g id="ytick_7">
     <g id="line2d_26">
      <g>
       <use style="stroke:#000000;stroke-width:0.8;" x="54" xlink:href="#m5e88bef2aa" y="171.60127"/>
      </g>
     </g>
     <g id="text_28">
      <!-- 0.6 -->
      <g transform="translate(31.096875 175.400488)scale(0.1 -0.1)">
       <use xlink:href="#DejaVuSans-48"/>
       <use x="63.623047" xlink:href="#DejaVuSans-46"/>
       <use x="95.410156" xlink:href="#DejaVuSans-54"/>
      </g>
     </g>
    </g>
    <g id="text_29">
     <!-- Norm (mm) -->
     <defs>
      <path d="M 9.8125 72.90625  L 23.09375 72.90625  L 55.421875 11.921875  L 55.421875 72.90625  L 64.984375 72.90625  L 64.984375 0  L 51.703125 0  L 19.390625 60.984375  L 19.390625 0  L 9.8125 0  z " id="DejaVuSans-78"/>
      <path d="M 30.609375 48.390625  Q 23.390625 48.390625 19.1875 42.75  Q 14.984375 37.109375 14.984375 27.296875  Q 14.984375 17.484375 19.15625 11.84375  Q 23.34375 6.203125 30.609375 6.203125  Q 37.796875 6.203125 41.984375 11.859375  Q 46.1875 17.53125 46.1875 27.296875  Q 46.1875 37.015625 41.984375 42.703125  Q 37.796875 48.390625 30.609375 48.390625  z M 30.609375 56  Q 42.328125 56 49.015625 48.375  Q 55.71875 40.765625 55.71875 27.296875  Q 55.71875 13.875 49.015625 6.21875  Q 42.328125 -1.421875 30.609375 -1.421875  Q 18.84375 -1.421875 12.171875 6.21875  Q 5.515625 13.875 5.515625 27.296875  Q 5.515625 40.765625 12.171875 48.375  Q 18.84375 56 30.609375 56  z " id="DejaVuSans-111"/>
      <path d="M 41.109375 46.296875  Q 39.59375 47.171875 37.8125 47.578125  Q 36.03125 48 33.890625 48  Q 26.265625 48 22.1875 43.046875  Q 18.109375 38.09375 18.109375 28.8125  L 18.109375 0  L 9.078125 0  L 9.078125 54.6875  L 18.109375 54.6875  L 18.109375 46.1875  Q 20.953125 51.171875 25.484375 53.578125  Q 30.03125 56 36.53125 56  Q 37.453125 56 38.578125 55.875  Q 39.703125 55.765625 41.0625 55.515625  z " id="DejaVuSans-114"/>
      <path d="M 52 44.1875  Q 55.375 50.25 60.0625 53.125  Q 64.75 56 71.09375 56  Q 79.640625 56 84.28125 50.015625  Q 88.921875 44.046875 88.921875 33.015625  L 88.921875 0  L 79.890625 0  L 79.890625 32.71875  Q 79.890625 40.578125 77.09375 44.375  Q 74.3125 48.1875 68.609375 48.1875  Q 61.625 48.1875 57.5625 43.546875  Q 53.515625 38.921875 53.515625 30.90625  L 53.515625 0  L 44.484375 0  L 44.484375 32.71875  Q 44.484375 40.625 41.703125 44.40625  Q 38.921875 48.1875 33.109375 48.1875  Q 26.21875 48.1875 22.15625 43.53125  Q 18.109375 38.875 18.109375 30.90625  L 18.109375 0  L 9.078125 0  L 9.078125 54.6875  L 18.109375 54.6875  L 18.109375 46.1875  Q 21.1875 51.21875 25.484375 53.609375  Q 29.78125 56 35.6875 56  Q 41.65625 56 45.828125 52.96875  Q 50 49.953125 52 44.1875  z " id="DejaVuSans-109"/>
      <path d="M 31 75.875  Q 24.46875 64.65625 21.28125 53.65625  Q 18.109375 42.671875 18.109375 31.390625  Q 18.109375 20.125 21.3125 9.0625  Q 24.515625 -2 31 -13.1875  L 23.1875 -13.1875  Q 15.875 -1.703125 12.234375 9.375  Q 8.59375 20.453125 8.59375 31.390625  Q 8.59375 42.28125 12.203125 53.3125  Q 15.828125 64.359375 23.1875 75.875  z " id="DejaVuSans-40"/>
      <path d="M 8.015625 75.875  L 15.828125 75.875  Q 23.140625 64.359375 26.78125 53.3125  Q 30.421875 42.28125 30.421875 31.390625  Q 30.421875 20.453125 26.78125 9.375  Q 23.140625 -1.703125 15.828125 -13.1875  L 8.015625 -13.1875  Q 14.5 -2 17.703125 9.0625  Q 20.90625 20.125 20.90625 31.390625  Q 20.90625 42.671875 17.703125 53.65625  Q 14.5 64.65625 8.015625 75.875  z " id="DejaVuSans-41"/>
     </defs>
     <g transform="translate(25.017187 231.538068)rotate(-90)scale(0.1 -0.1)">
      <use xlink:href="#DejaVuSans-78"/>
      <use x="74.804688" xlink:href="#DejaVuSans-111"/>
      <use x="135.986328" xlink:href="#DejaVuSans-114"/>
      <use x="177.083984" xlink:href="#DejaVuSans-109"/>
      <use x="274.496094" xlink:href="#DejaVuSans-32"/>
      <use x="306.283203" xlink:href="#DejaVuSans-40"/>
      <use x="345.296875" xlink:href="#DejaVuSans-109"/>
      <use x="442.708984" xlink:href="#DejaVuSans-109"/>
      <use x="540.121094" xlink:href="#DejaVuSans-41"/>
     </g>
    </g>
   </g>
   <g id="line2d_27">
    <path clip-path="url(#p3ba076beda)" d="M 54 252  L 55.870391 249.695382  L 57.740782 241.222546  L 59.611173 247.699942  L 61.481564 243.296712  L 63.351955 220.234324  L 65.222346 206.77718  L 67.092737 237.771866  L 68.963128 241.412234  L 70.83352 240.499248  L 72.703911 241.119312  L 74.574302 235.564821  L 76.444693 238.199645  L 78.315084 235.906694  L 80.185475 230.607514  L 82.055866 238.108343  L 83.926257 241.44451  L 85.796648 246.803899  L 87.667039 214.962695  L 89.53743 237.723281  L 91.407821 237.356701  L 93.278212 234.495098  L 95.148603 239.710547  L 97.018994 241.920008  L 98.889385 214.999839  L 100.759777 204.857319  L 102.630168 229.573696  L 104.500559 229.597509  L 106.37095 238.429603  L 108.241341 236.022481  L 110.111732 213.153008  L 111.982123 215.392943  L 113.852514 234.674397  L 115.722905 229.719909  L 117.593296 235.516737  L 119.463687 235.752419  L 121.334078 240.442367  L 123.204469 238.682373  L 125.07486 243.018033  L 126.945251 232.852914  L 128.815642 231.908032  L 130.686034 234.230495  L 132.556425 218.490004  L 134.426816 235.438752  L 136.297207 218.818748  L 138.167598 242.869402  L 140.037989 233.421257  L 141.90838 232.356483  L 143.778771 245.710255  L 145.649162 236.996429  L 147.519553 238.830799  L 149.389944 229.954658  L 151.260335 213.426494  L 153.130726 233.531225  L 155.001117 235.565984  L 156.871508 237.069247  L 158.741899 230.335053  L 160.612291 238.789181  L 162.482682 241.578071  L 164.353073 247.301184  L 166.223464 239.73566  L 168.093855 239.414366  L 169.964246 207.699125  L 171.834637 229.506222  L 173.705028 213.21581  L 175.575419 210.968008  L 177.44581 206.357149  L 179.316201 220.615953  L 181.186592 233.605214  L 183.056983 213.978566  L 184.927374 240.51483  L 186.797765 241.016673  L 188.668156 225.253024  L 190.538547 237.91892  L 192.408939 242.281366  L 194.27933 245.142825  L 196.149721 239.583168  L 198.020112 244.570697  L 201.760894 234.608361  L 203.631285 236.885459  L 205.501676 235.365384  L 207.372067 221.540585  L 209.242458 186.73314  L 211.112849 224.801259  L 212.98324 234.672065  L 214.853631 243.589108  L 216.724022 223.825368  L 218.594413 164.951986  L 220.464804 208.493037  L 222.335196 173.500285  L 224.205587 185.196462  L 226.075978 153.163636  L 227.946369 197.311809  L 229.81676 232.262569  L 231.687151 194.95937  L 233.557542 226.359808  L 235.427933 227.249738  L 237.298324 232.607511  L 239.168715 234.440225  L 241.039106 223.486978  L 242.909497 217.987189  L 244.779888 227.558386  L 246.650279 203.585432  L 248.52067 240.040876  L 250.391061 218.059664  L 252.261453 234.154795  L 254.131844 230.283969  L 256.002235 225.001541  L 257.872626 242.881297  L 259.743017 236.493867  L 261.613408 242.824097  L 263.483799 239.03822  L 265.35419 190.129257  L 267.224581 196.608727  L 269.094972 222.958795  L 270.965363 225.497821  L 272.835754 231.406013  L 274.706145 242.888088  L 276.576536 225.440219  L 278.446927 236.515747  L 280.317318 240.274911  L 282.187709 231.873008  L 284.058101 243.068573  L 285.928492 236.895927  L 287.798883 214.45969  L 289.669274 208.761141  L 291.539665 216.238506  L 293.410056 191.219626  L 295.280447 209.100942  L 297.150838 223.731054  L 299.021229 236.188757  L 300.89162 224.723044  L 302.762011 214.397431  L 304.632402 217.202423  L 306.502793 242.022821  L 308.373184 202.756551  L 310.243575 223.624902  L 312.113966 213.533381  L 315.854749 183.929125  L 317.72514 164.423319  L 319.595531 230.897863  L 321.465922 240.397511  L 323.336313 216.38327  L 325.206704 236.761859  L 327.077095 231.289879  L 328.947486 204.572663  L 330.817877 209.269481  L 332.688268 178.346272  L 334.558659 221.188259  L 336.42905 183.191112  L 338.299441 164.728595  L 340.169832 227.404992  L 342.040223 233.618888  L 343.910615 236.13816  L 345.781006 213.799415  L 347.651397 230.687349  L 349.521788 231.300247  L 351.392179 221.525604  L 353.26257 241.272815  L 355.132961 233.918327  L 357.003352 177.194776  L 358.873743 234.328298  L 360.744134 224.667126  L 362.614525 231.547151  L 364.484916 224.943427  L 366.355307 234.516292  L 368.225698 221.590707  L 370.096089 235.406227  L 371.96648 242.712781  L 373.836872 239.791884  L 375.707263 233.313688  L 377.577654 233.654153  L 379.448045 239.549109  L 381.318436 242.849145  L 383.188827 242.029631  L 385.059218 222.747376  L 386.929609 241.212801  L 388.8 234.214328  L 388.8 234.214328  " style="fill:none;stroke:#1f77b4;stroke-linecap:square;stroke-width:1.5;"/>
   </g>
   <g id="patch_8">
    <path d="M 54 252  L 54 153.163636  " style="fill:none;stroke:#000000;stroke-linecap:square;stroke-linejoin:miter;stroke-width:0.8;"/>
   </g>
   <g id="patch_9">
    <path d="M 388.8 252  L 388.8 153.163636  " style="fill:none;stroke:#000000;stroke-linecap:square;stroke-linejoin:miter;stroke-width:0.8;"/>
   </g>
   <g id="patch_10">
    <path d="M 54 252  L 388.8 252  " style="fill:none;stroke:#000000;stroke-linecap:square;stroke-linejoin:miter;stroke-width:0.8;"/>
   </g>
   <g id="patch_11">
    <path d="M 54 153.163636  L 388.8 153.163636  " style="fill:none;stroke:#000000;stroke-linecap:square;stroke-linejoin:miter;stroke-width:0.8;"/>
   </g>
  </g>
 </g>
 <defs>
  <clipPath id="p8b93139267">
   <rect height="98.836364" width="334.8" x="54" y="34.56"/>
  </clipPath>
  <clipPath id="p3ba076beda">
   <rect height="98.836364" width="334.8" x="54" y="153.163636"/>
  </clipPath>
 </defs>
</svg>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Which volumes are problematic?</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">outliers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;output/work_preproc/_subject_id_07/art/&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;art.asub-07_ses-test_task-fingerfootlips_bold_roi_mcf_outliers.txt&#39;</span><span class="p">))</span>
<span class="nb">list</span><span class="p">(</span><span class="n">outliers</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/optnfs/el7/jupyterhub/envs/Psych60-Chang/lib/python3.7/site-packages/ipykernel_launcher.py:2: UserWarning: loadtxt: Empty input file: &#34;/dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/art/art.asub-07_ses-test_task-fingerfootlips_bold_roi_mcf_outliers.txt&#34;
  
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[]</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Masks-and-Probability-maps">Masks and Probability maps<a class="anchor-link" href="#Masks-and-Probability-maps"> </a></h3><p>Let's see what all the masks and probability maps look like. For this, we will use <code>nilearn</code>'s <code>plot_anat</code> function.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">image</span> <span class="k">as</span> <span class="n">nli</span>
<span class="kn">from</span> <span class="nn">nilearn.plotting</span> <span class="kn">import</span> <span class="n">plot_stat_map</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;output/work_preproc/_subject_id_07/&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>First, let's look at the tissue probability maps.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">anat</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s1">&#39;gunzip_anat/sub-07_ses-test_T1w.nii&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot_stat_map</span><span class="p">(</span>
    <span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s1">&#39;segment/c1sub-07_ses-test_T1w.nii&#39;</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;GM prob. map&#39;</span><span class="p">,</span>  <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">magma</span><span class="p">,</span>
    <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">anat</span><span class="p">,</span> <span class="n">display_mode</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">cut_coords</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">35</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/optnfs/el7/jupyterhub/envs/Psych60-Chang/lib/python3.7/site-packages/scipy/ndimage/measurements.py:272: DeprecationWarning: In future, it will be an error for &#39;np.bool_&#39; scalars to be interpreted as an index
  return _nd_image.find_objects(input, max_label)
/optnfs/el7/jupyterhub/envs/Psych60-Chang/lib/python3.7/site-packages/scipy/ndimage/measurements.py:272: DeprecationWarning: In future, it will be an error for &#39;np.bool_&#39; scalars to be interpreted as an index
  return _nd_image.find_objects(input, max_label)
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../../images/features/notebooks/7_Nipype_Preprocessing_123_1.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot_stat_map</span><span class="p">(</span>
    <span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s1">&#39;segment/c2sub-07_ses-test_T1w.nii&#39;</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;WM prob. map&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">magma</span><span class="p">,</span>
    <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">anat</span><span class="p">,</span> <span class="n">display_mode</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">cut_coords</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">35</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/optnfs/el7/jupyterhub/envs/Psych60-Chang/lib/python3.7/site-packages/scipy/ndimage/measurements.py:272: DeprecationWarning: In future, it will be an error for &#39;np.bool_&#39; scalars to be interpreted as an index
  return _nd_image.find_objects(input, max_label)
/optnfs/el7/jupyterhub/envs/Psych60-Chang/lib/python3.7/site-packages/scipy/ndimage/measurements.py:272: DeprecationWarning: In future, it will be an error for &#39;np.bool_&#39; scalars to be interpreted as an index
  return _nd_image.find_objects(input, max_label)
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../../images/features/notebooks/7_Nipype_Preprocessing_124_1.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot_stat_map</span><span class="p">(</span>
    <span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s1">&#39;segment/c3sub-07_ses-test_T1w.nii&#39;</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;CSF prob. map&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">magma</span><span class="p">,</span>
    <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">anat</span><span class="p">,</span> <span class="n">display_mode</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">cut_coords</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">35</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/optnfs/el7/jupyterhub/envs/Psych60-Chang/lib/python3.7/site-packages/scipy/ndimage/measurements.py:272: DeprecationWarning: In future, it will be an error for &#39;np.bool_&#39; scalars to be interpreted as an index
  return _nd_image.find_objects(input, max_label)
/optnfs/el7/jupyterhub/envs/Psych60-Chang/lib/python3.7/site-packages/scipy/ndimage/measurements.py:272: DeprecationWarning: In future, it will be an error for &#39;np.bool_&#39; scalars to be interpreted as an index
  return _nd_image.find_objects(input, max_label)
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../../images/features/notebooks/7_Nipype_Preprocessing_125_1.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And how does the gray matter mask look like that we used on the functional images?</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot_stat_map</span><span class="p">(</span>
    <span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s1">&#39;mask_GM/c1sub-07_ses-test_T1w_flirt_thresh.nii&#39;</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;dilated GM Mask&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">magma</span><span class="p">,</span>
    <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">anat</span><span class="p">,</span> <span class="n">display_mode</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">cut_coords</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">35</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/optnfs/el7/jupyterhub/envs/Psych60-Chang/lib/python3.7/site-packages/scipy/ndimage/measurements.py:272: DeprecationWarning: In future, it will be an error for &#39;np.bool_&#39; scalars to be interpreted as an index
  return _nd_image.find_objects(input, max_label)
/optnfs/el7/jupyterhub/envs/Psych60-Chang/lib/python3.7/site-packages/scipy/ndimage/measurements.py:272: DeprecationWarning: In future, it will be an error for &#39;np.bool_&#39; scalars to be interpreted as an index
  return _nd_image.find_objects(input, max_label)
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../../images/features/notebooks/7_Nipype_Preprocessing_127_1.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Functional-Image-transformations">Functional Image transformations<a class="anchor-link" href="#Functional-Image-transformations"> </a></h3><p>Let's also investigate the transformation that we applied to the functional images.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">image</span> <span class="k">as</span> <span class="n">nli</span>
<span class="kn">from</span> <span class="nn">nilearn.plotting</span> <span class="kn">import</span> <span class="n">plot_epi</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;output/work_preproc/_subject_id_07/&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot_epi</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s1">&#39;mcflirt/asub-07_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz_mean_reg.nii.gz&#39;</span><span class="p">),</span>
         <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Motion Corrected mean image&#39;</span><span class="p">,</span> <span class="n">display_mode</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">cut_coords</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
         <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../../images/features/notebooks/7_Nipype_Preprocessing_130_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mean</span> <span class="o">=</span> <span class="n">nli</span><span class="o">.</span><span class="n">mean_img</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s1">&#39;applywarp/asub-07_ses-test_task-fingerfootlips_bold_roi_mcf_flirt.nii&#39;</span><span class="p">))</span>
<span class="n">plot_epi</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Coregistred mean image&#39;</span><span class="p">,</span> <span class="n">display_mode</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">cut_coords</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
         <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../../images/features/notebooks/7_Nipype_Preprocessing_131_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mean</span> <span class="o">=</span> <span class="n">nli</span><span class="o">.</span><span class="n">mean_img</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;output/work_preproc/susan/_subject_id_07/smooth/mapflow/_smooth0/&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;asub-07_ses-test_task-fingerfootlips_bold_roi_mcf_flirt_smooth.nii.gz&#39;</span><span class="p">))</span>
<span class="n">plot_epi</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Smoothed mean image&#39;</span><span class="p">,</span> <span class="n">display_mode</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">cut_coords</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
         <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../../images/features/notebooks/7_Nipype_Preprocessing_132_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mean</span> <span class="o">=</span> <span class="n">nli</span><span class="o">.</span><span class="n">mean_img</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s1">&#39;mask_func/mapflow/_mask_func0/&#39;</span>
                    <span class="s1">&#39;asub-07_ses-test_task-fingerfootlips_bold_roi_mcf_flirt_smooth_masked.nii&#39;</span><span class="p">))</span>
<span class="n">plot_epi</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Masked mean image&#39;</span><span class="p">,</span> <span class="n">display_mode</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">cut_coords</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
         <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../../images/features/notebooks/7_Nipype_Preprocessing_133_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot_epi</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s1">&#39;detrend/mean.nii.gz&#39;</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Detrended mean image&#39;</span><span class="p">,</span> <span class="n">display_mode</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span>
         <span class="n">cut_coords</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../../images/features/notebooks/7_Nipype_Preprocessing_134_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>That's all nice and beautiful, but what did smoothing and detrending actually do to the data?</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn">nibabel</span> <span class="k">as</span> <span class="nn">nb</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;output/work_preproc/_subject_id_07/&#39;</span><span class="p">)</span>

<span class="c1"># Load the relevant datasets</span>
<span class="n">mc</span> <span class="o">=</span> <span class="n">nb</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s1">&#39;applywarp/asub-07_ses-test_task-fingerfootlips_bold_roi_mcf_flirt.nii&#39;</span><span class="p">))</span>
<span class="n">smooth</span> <span class="o">=</span> <span class="n">nb</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;output/work_preproc/susan/_subject_id_07/smooth/mapflow/&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;_smooth0/asub-07_ses-test_task-fingerfootlips_bold_roi_mcf_flirt_smooth.nii.gz&#39;</span><span class="p">))</span>
<span class="n">detrended_data</span> <span class="o">=</span> <span class="n">nb</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">output</span> <span class="o">+</span> <span class="s1">&#39;detrend/detrend.nii.gz&#39;</span><span class="p">)</span>

<span class="c1"># Plot a representative voxel</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">43</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mc</span><span class="o">.</span><span class="n">get_data</span><span class="p">()[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="p">:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">smooth</span><span class="o">.</span><span class="n">get_data</span><span class="p">()[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="p">:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">detrended_data</span><span class="o">.</span><span class="n">get_data</span><span class="p">()[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="p">:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;motion corrected&#39;</span><span class="p">,</span> <span class="s1">&#39;smoothed&#39;</span><span class="p">,</span> <span class="s1">&#39;detrended&#39;</span><span class="p">]);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../../images/features/notebooks/7_Nipype_Preprocessing_136_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data-output-with-DataSink">Data output with <code>DataSink</code><a class="anchor-link" href="#Data-output-with-DataSink"> </a></h2><p>The results look fine, but we don't need all those temporary files. So let's use Datasink to keep only those files that we actually need for the 1st and 2nd level analysis.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nipype.interfaces.io</span> <span class="kn">import</span> <span class="n">DataSink</span>

<span class="c1"># Initiate the datasink node</span>
<span class="n">output_folder</span> <span class="o">=</span> <span class="s1">&#39;datasink_handson&#39;</span>
<span class="n">datasink</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">DataSink</span><span class="p">(</span><span class="n">base_directory</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;output/&#39;</span><span class="p">),</span>
                         <span class="n">container</span><span class="o">=</span><span class="n">output_folder</span><span class="p">),</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;datasink&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now the next step is to specify all the output that we want to keep in our output folder <code>output</code>. Make sure to keep:</p>
<ul>
<li>from the artifact detection node the outlier file as well as the outlier plot</li>
<li>from the motion correction node the motion parameters</li>
<li>from the last node, the detrended functional image</li>
</ul>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Connect nodes to datasink here</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">preproc</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">art</span><span class="p">,</span> <span class="n">datasink</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;outlier_files&#39;</span><span class="p">,</span> <span class="s1">&#39;preproc.@outlier_files&#39;</span><span class="p">),</span>
                                  <span class="p">(</span><span class="s1">&#39;plot_files&#39;</span><span class="p">,</span> <span class="s1">&#39;preproc.@plot_files&#39;</span><span class="p">)]),</span>
                 <span class="p">(</span><span class="n">mcflirt</span><span class="p">,</span> <span class="n">datasink</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;par_file&#39;</span><span class="p">,</span> <span class="s1">&#39;preproc.@par&#39;</span><span class="p">)]),</span>
                 <span class="p">(</span><span class="n">detrend</span><span class="p">,</span> <span class="n">datasink</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;detrended_file&#39;</span><span class="p">,</span> <span class="s1">&#39;preproc.@func&#39;</span><span class="p">)]),</span>
                 <span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Run-the-workflow">Run the workflow<a class="anchor-link" href="#Run-the-workflow"> </a></h2><p>After adding the datasink folder, let's run the preprocessing workflow again.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">preproc</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;MultiProc&#39;</span><span class="p">,</span> <span class="n">plugin_args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;n_procs&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">})</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>190416-11:30:54,227 nipype.workflow INFO:
	 Workflow work_preproc settings: [&#39;check&#39;, &#39;execution&#39;, &#39;logging&#39;, &#39;monitoring&#39;]
190416-11:30:54,427 nipype.workflow INFO:
	 Running in parallel.
190416-11:30:54,434 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 1 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 4/4.
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/optnfs/el7/jupyterhub/envs/Psych60-Chang/lib/python3.7/site-packages/numpy/matrixlib/defmatrix.py:71: PendingDeprecationWarning: the matrix subclass is not the recommended way to represent matrices or deal with linear algebra (see https://docs.scipy.org/doc/numpy/user/numpy-for-matlab-users.html). Please adjust your code to use regular ndarray.
  return matrix(data, dtype=dtype, copy=False)
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>190416-11:30:54,647 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.selectfiles&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/selectfiles&#34;.
190416-11:30:54,760 nipype.workflow INFO:
	 [Node] Running &#34;selectfiles&#34; (&#34;nipype.interfaces.io.SelectFiles&#34;)
190416-11:30:54,807 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.selectfiles&#34;.
190416-11:30:56,437 nipype.workflow INFO:
	 [Job 0] Completed (work_preproc.selectfiles).
190416-11:30:56,445 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 4/4.
190416-11:30:56,627 nipype.workflow INFO:
	 [Job 1] Cached (work_preproc.gunzip_func).
190416-11:30:56,637 nipype.workflow INFO:
	 [Job 6] Cached (work_preproc.gunzip_anat).
190416-11:30:58,572 nipype.workflow INFO:
	 [Job 2] Cached (work_preproc.extract).
190416-11:30:58,586 nipype.workflow INFO:
	 [Job 7] Cached (work_preproc.segment).
190416-11:31:00,440 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 3 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 4/4.
190416-11:31:00,581 nipype.workflow INFO:
	 [Job 3] Cached (work_preproc.slicetime).
190416-11:31:00,597 nipype.workflow INFO:
	 [Job 8] Cached (work_preproc.resample).
190416-11:31:00,612 nipype.workflow INFO:
	 [Job 10] Cached (work_preproc.threshold_WM).
190416-11:31:02,442 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 4/4.
190416-11:31:02,583 nipype.workflow INFO:
	 [Job 4] Cached (work_preproc.mcflirt).
190416-11:31:02,596 nipype.workflow INFO:
	 [Job 9] Cached (work_preproc.mask_GM).
190416-11:31:04,590 nipype.workflow INFO:
	 [Node] Outdated cache found for &#34;work_preproc.art&#34;.
190416-11:31:04,598 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.art&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/art&#34;.
190416-11:31:04,605 nipype.workflow INFO:
	 [Node] Outdated cache found for &#34;work_preproc.art&#34;.
190416-11:31:04,610 nipype.workflow INFO:
	 [Job 11] Cached (work_preproc.coreg).
190416-11:31:04,706 nipype.workflow INFO:
	 [Node] Running &#34;art&#34; (&#34;nipype.algorithms.rapidart.ArtifactDetect&#34;)
190416-11:31:05,938 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.art&#34;.
190416-11:31:06,445 nipype.workflow INFO:
	 [Job 5] Completed (work_preproc.art).
190416-11:31:06,450 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 1 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 4/4.
190416-11:31:06,603 nipype.workflow INFO:
	 [Job 12] Cached (work_preproc.applywarp).
190416-11:31:08,448 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 4/4.
190416-11:31:08,597 nipype.workflow INFO:
	 [Job 13] Cached (work_preproc.susan.mask).
190416-11:31:08,617 nipype.workflow INFO:
	 [Job 15] Cached (work_preproc.susan.median).
190416-11:31:10,450 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 1 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 4/4.
190416-11:31:10,595 nipype.workflow INFO:
	 [Job 14] Cached (work_preproc.susan.meanfunc2).
190416-11:31:12,597 nipype.workflow INFO:
	 [Job 16] Cached (work_preproc.susan.merge).
190416-11:31:14,596 nipype.workflow INFO:
	 [Job 17] Cached (work_preproc.susan.multi_inputs).
190416-11:31:16,606 nipype.workflow INFO:
	 [Job 18] Cached (work_preproc.susan.smooth).
190416-11:31:18,602 nipype.workflow INFO:
	 [Job 19] Cached (work_preproc.mask_func).
190416-11:31:20,599 nipype.workflow INFO:
	 [Node] Outdated cache found for &#34;work_preproc.detrend&#34;.
190416-11:31:20,606 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.detrend&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/detrend&#34;.
190416-11:31:20,613 nipype.workflow INFO:
	 [Node] Outdated cache found for &#34;work_preproc.detrend&#34;.
190416-11:31:20,728 nipype.workflow INFO:
	 [Node] Running &#34;detrend&#34; (&#34;nipype.algorithms.confounds.TSNR&#34;)
190416-11:31:22,464 nipype.workflow INFO:
	 [MultiProc] Running 1 tasks, and 0 jobs ready. Free memory (GB): 56.18/56.38, Free processors: 3/4.
                     Currently running:
                       * work_preproc.detrend
190416-11:31:33,367 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.detrend&#34;.
190416-11:31:34,473 nipype.workflow INFO:
	 [Job 20] Completed (work_preproc.detrend).
190416-11:31:34,479 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 1 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 4/4.
190416-11:31:34,661 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.datasink&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/datasink&#34;.
190416-11:31:34,710 nipype.workflow INFO:
	 [Node] Running &#34;datasink&#34; (&#34;nipype.interfaces.io.DataSink&#34;)
190416-11:31:34,805 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.datasink&#34;.
190416-11:31:36,475 nipype.workflow INFO:
	 [Job 21] Completed (work_preproc.datasink).
190416-11:31:36,481 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 0 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 4/4.
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;networkx.classes.digraph.DiGraph at 0x2ad267fa7400&gt;</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's look now at the output of this datasink folder.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>tree -L <span class="m">3</span> <span class="o">{</span>join<span class="o">(</span>output_dir, <span class="s1">&#39;output/datasink_handson/&#39;</span><span class="o">)}</span> -I <span class="s1">&#39;*js|*json|*pklz|_report|*dot|*html|*txt|*.m&#39;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/
`-- preproc
    |-- plot.sub-02.svg
    |-- plot.sub-03.svg
    |-- plot.sub-04.svg
    |-- plot.sub-07.svg
    |-- plot.sub-09.svg
    |-- sub-02_detrend.nii.gz
    |-- sub-02.par
    |-- sub-03_detrend.nii.gz
    |-- sub-03.par
    |-- sub-04_detrend.nii.gz
    |-- sub-04.par
    |-- sub-07_detrend.nii.gz
    |-- sub-07.par
    |-- sub-09_detrend.nii.gz
    `-- sub-09.par

1 directory, 15 files
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Much better! But we're still not there yet. There are many unnecessary file specifiers that we can get rid off. To do so, we can use <code>DataSink</code>'s <code>substitutions</code> parameter. For this, we create a list of tuples: on the left, we specify the string that we want to replace and on the right, with what we want to replace it with.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">## Use the following substitutions for the DataSink output</span>
<span class="n">substitutions</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;asub&#39;</span><span class="p">,</span> <span class="s1">&#39;sub&#39;</span><span class="p">),</span>
                 <span class="p">(</span><span class="s1">&#39;_ses-test_task-fingerfootlips_bold_roi_mcf&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                 <span class="p">(</span><span class="s1">&#39;.nii.gz.par&#39;</span><span class="p">,</span> <span class="s1">&#39;.par&#39;</span><span class="p">),</span>
                 <span class="p">]</span>

<span class="c1"># To get rid of the folder &#39;_subject_id_07&#39; and renaming detrend</span>
<span class="n">substitutions</span> <span class="o">+=</span> <span class="p">[(</span><span class="s1">&#39;_subject_id_</span><span class="si">%s</span><span class="s1">/detrend&#39;</span> <span class="o">%</span> <span class="n">s</span><span class="p">,</span>
                   <span class="s1">&#39;_subject_id_</span><span class="si">%s</span><span class="s1">/sub-</span><span class="si">%s</span><span class="s1">_detrend&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">subject_list</span><span class="p">]</span>
<span class="n">substitutions</span> <span class="o">+=</span> <span class="p">[(</span><span class="s1">&#39;_subject_id_</span><span class="si">%s</span><span class="s1">/&#39;</span> <span class="o">%</span> <span class="n">s</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">subject_list</span><span class="p">]</span>
<span class="n">datasink</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">substitutions</span> <span class="o">=</span> <span class="n">substitutions</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Before we run the preprocessing workflow again, let's first delete the current output folder:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Delets the current output folder</span>
<span class="o">!</span>rm -rf <span class="o">{</span>join<span class="o">(</span>output_dir, <span class="s1">&#39;output/datasink_handson&#39;</span><span class="o">)}</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Runs the preprocessing workflow again, this time with substitutions</span>
<span class="n">preproc</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;MultiProc&#39;</span><span class="p">,</span> <span class="n">plugin_args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;n_procs&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">})</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>190416-11:55:58,604 nipype.workflow INFO:
	 Workflow work_preproc settings: [&#39;check&#39;, &#39;execution&#39;, &#39;logging&#39;, &#39;monitoring&#39;]
190416-11:55:58,809 nipype.workflow INFO:
	 Running in parallel.
190416-11:55:58,816 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 1 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 4/4.
190416-11:55:59,63 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.selectfiles&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/selectfiles&#34;.
190416-11:55:59,147 nipype.workflow INFO:
	 [Node] Running &#34;selectfiles&#34; (&#34;nipype.interfaces.io.SelectFiles&#34;)
190416-11:55:59,194 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.selectfiles&#34;.
190416-11:56:00,820 nipype.workflow INFO:
	 [Job 0] Completed (work_preproc.selectfiles).
190416-11:56:00,828 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 4/4.
190416-11:56:01,63 nipype.workflow INFO:
	 [Job 1] Cached (work_preproc.gunzip_func).
190416-11:56:01,74 nipype.workflow INFO:
	 [Job 6] Cached (work_preproc.gunzip_anat).
190416-11:56:02,960 nipype.workflow INFO:
	 [Job 2] Cached (work_preproc.extract).
190416-11:56:02,972 nipype.workflow INFO:
	 [Job 7] Cached (work_preproc.segment).
190416-11:56:04,822 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 3 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 4/4.
190416-11:56:04,962 nipype.workflow INFO:
	 [Job 3] Cached (work_preproc.slicetime).
190416-11:56:04,977 nipype.workflow INFO:
	 [Job 8] Cached (work_preproc.resample).
190416-11:56:04,989 nipype.workflow INFO:
	 [Job 10] Cached (work_preproc.threshold_WM).
190416-11:56:06,824 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 4/4.
190416-11:56:06,963 nipype.workflow INFO:
	 [Job 4] Cached (work_preproc.mcflirt).
190416-11:56:06,974 nipype.workflow INFO:
	 [Job 9] Cached (work_preproc.mask_GM).
190416-11:56:08,973 nipype.workflow INFO:
	 [Job 5] Cached (work_preproc.art).
190416-11:56:08,992 nipype.workflow INFO:
	 [Job 11] Cached (work_preproc.coreg).
190416-11:56:10,828 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 1 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 4/4.
190416-11:56:10,973 nipype.workflow INFO:
	 [Job 12] Cached (work_preproc.applywarp).
190416-11:56:12,830 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 4/4.
190416-11:56:13,11 nipype.workflow INFO:
	 [Job 13] Cached (work_preproc.susan.mask).
190416-11:56:13,27 nipype.workflow INFO:
	 [Job 15] Cached (work_preproc.susan.median).
190416-11:56:14,832 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 1 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 4/4.
190416-11:56:14,989 nipype.workflow INFO:
	 [Job 14] Cached (work_preproc.susan.meanfunc2).
190416-11:56:16,978 nipype.workflow INFO:
	 [Job 16] Cached (work_preproc.susan.merge).
190416-11:56:18,977 nipype.workflow INFO:
	 [Job 17] Cached (work_preproc.susan.multi_inputs).
190416-11:56:20,986 nipype.workflow INFO:
	 [Job 18] Cached (work_preproc.susan.smooth).
190416-11:56:22,982 nipype.workflow INFO:
	 [Job 19] Cached (work_preproc.mask_func).
190416-11:56:24,981 nipype.workflow INFO:
	 [Job 20] Cached (work_preproc.detrend).
190416-11:56:27,11 nipype.workflow INFO:
	 [Node] Outdated cache found for &#34;work_preproc.datasink&#34;.
190416-11:56:27,21 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.datasink&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/datasink&#34;.
190416-11:56:27,28 nipype.workflow INFO:
	 [Node] Outdated cache found for &#34;work_preproc.datasink&#34;.
190416-11:56:27,113 nipype.workflow INFO:
	 [Node] Running &#34;datasink&#34; (&#34;nipype.interfaces.io.DataSink&#34;)
190416-11:56:27,124 nipype.interface INFO:
	 sub: /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/_subject_id_07/asub-07_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz.par -&gt; /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/sub-07.par
190416-11:56:27,141 nipype.interface INFO:
	 sub: /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/_subject_id_07/art.asub-07_ses-test_task-fingerfootlips_bold_roi_mcf_outliers.txt -&gt; /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/art.sub-07_outliers.txt
190416-11:56:27,147 nipype.interface INFO:
	 sub: /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/_subject_id_07/plot.asub-07_ses-test_task-fingerfootlips_bold_roi_mcf.svg -&gt; /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/plot.sub-07.svg
190416-11:56:27,155 nipype.interface INFO:
	 sub: /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/_subject_id_07/detrend.nii.gz -&gt; /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/sub-07_detrend.nii.gz
190416-11:56:27,206 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.datasink&#34;.
190416-11:56:28,845 nipype.workflow INFO:
	 [Job 21] Completed (work_preproc.datasink).
190416-11:56:28,850 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 0 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 4/4.
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;networkx.classes.digraph.DiGraph at 0x2ad2656a97f0&gt;</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>tree <span class="o">{</span>join<span class="o">(</span>output_dir, <span class="s1">&#39;output/datasink_handson/&#39;</span><span class="o">)}</span> -I <span class="s1">&#39;*js|*json|*pklz|_report|*dot|*html|*txt|*.m&#39;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/
`-- preproc
    |-- plot.sub-02.svg
    |-- plot.sub-03.svg
    |-- plot.sub-04.svg
    |-- plot.sub-07.svg
    |-- plot.sub-09.svg
    |-- sub-02_detrend.nii.gz
    |-- sub-02.par
    |-- sub-03_detrend.nii.gz
    |-- sub-03.par
    |-- sub-04_detrend.nii.gz
    |-- sub-04.par
    |-- sub-07_detrend.nii.gz
    |-- sub-07.par
    |-- sub-09_detrend.nii.gz
    `-- sub-09.par

1 directory, 15 files
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Run-Preprocessing-workflow-on-6-right-handed-subjects">Run Preprocessing workflow on 6 right-handed subjects<a class="anchor-link" href="#Run-Preprocessing-workflow-on-6-right-handed-subjects"> </a></h1>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Perfect!</p>
<p>Now we might want to run this pipeline for many subjects.  In this example, we will run all right-handed subjects. For this, you just need to change the <code>subject_list</code> variable and run again the places where this variable is used (i.e. <code>sf.iterables</code> and in <code>DataSink</code> <code>substitutions</code>.</p>
<p><strong>NOTE</strong>: For today due to the limited resources of our jupyter hub server, we will be just looking at the results that have already been run.  However, feel free to run this on your after class.</p>
<p>The full output can be viewed at the following location:</p>
<p><code>/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing</code></p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Update &#39;subject_list&#39; and its dependencies here</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">subject_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;02&#39;</span><span class="p">,</span> <span class="s1">&#39;03&#39;</span><span class="p">,</span> <span class="s1">&#39;04&#39;</span><span class="p">,</span> <span class="s1">&#39;07&#39;</span><span class="p">,</span> <span class="s1">&#39;08&#39;</span><span class="p">,</span> <span class="s1">&#39;09&#39;</span><span class="p">]</span>

<span class="n">sf</span><span class="o">.</span><span class="n">iterables</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;subject_id&#39;</span><span class="p">,</span> <span class="n">subject_list</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># To get rid of the folder &#39;_subject_id_02&#39; and renaming detrend</span>
<span class="n">substitutions</span> <span class="o">+=</span> <span class="p">[(</span><span class="s1">&#39;_subject_id_</span><span class="si">%s</span><span class="s1">/detrend&#39;</span> <span class="o">%</span> <span class="n">s</span><span class="p">,</span>
                   <span class="s1">&#39;_subject_id_</span><span class="si">%s</span><span class="s1">/sub-</span><span class="si">%s</span><span class="s1">_detrend&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">subject_list</span><span class="p">]</span>
<span class="n">substitutions</span> <span class="o">+=</span> <span class="p">[(</span><span class="s1">&#39;_subject_id_</span><span class="si">%s</span><span class="s1">/&#39;</span> <span class="o">%</span> <span class="n">s</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">subject_list</span><span class="p">]</span>
<span class="n">datasink</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">substitutions</span> <span class="o">=</span> <span class="n">substitutions</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we can run the workflow again, this time for all right handed subjects in parallel.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Runs the preprocessing workflow again, this time with substitutions</span>
<span class="n">preproc</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;MultiProc&#39;</span><span class="p">,</span> <span class="n">plugin_args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;n_procs&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">})</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>190416-12:41:17,521 nipype.workflow INFO:
	 Workflow work_preproc settings: [&#39;check&#39;, &#39;execution&#39;, &#39;logging&#39;, &#39;monitoring&#39;]
190416-12:41:17,943 nipype.workflow INFO:
	 Running in parallel.
190416-12:41:17,958 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 6 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 8/8.
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/optnfs/el7/jupyterhub/envs/Psych60-Chang/lib/python3.7/site-packages/numpy/matrixlib/defmatrix.py:71: PendingDeprecationWarning: the matrix subclass is not the recommended way to represent matrices or deal with linear algebra (see https://docs.scipy.org/doc/numpy/user/numpy-for-matlab-users.html). Please adjust your code to use regular ndarray.
  return matrix(data, dtype=dtype, copy=False)
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>190416-12:41:18,272 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.selectfiles&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_09/selectfiles&#34;.
190416-12:41:18,279 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.selectfiles&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_08/selectfiles&#34;.
190416-12:41:18,283 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.selectfiles&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/selectfiles&#34;.
190416-12:41:18,288 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.selectfiles&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_04/selectfiles&#34;.
190416-12:41:18,292 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.selectfiles&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_03/selectfiles&#34;.
190416-12:41:18,299 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.selectfiles&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_02/selectfiles&#34;.
190416-12:41:18,433 nipype.workflow INFO:
	 [Node] Running &#34;selectfiles&#34; (&#34;nipype.interfaces.io.SelectFiles&#34;)
190416-12:41:18,436 nipype.workflow INFO:
	 [Node] Running &#34;selectfiles&#34; (&#34;nipype.interfaces.io.SelectFiles&#34;)
190416-12:41:18,441 nipype.workflow INFO:
	 [Node] Running &#34;selectfiles&#34; (&#34;nipype.interfaces.io.SelectFiles&#34;)
190416-12:41:18,445 nipype.workflow INFO:
	 [Node] Running &#34;selectfiles&#34; (&#34;nipype.interfaces.io.SelectFiles&#34;)
190416-12:41:18,450 nipype.workflow INFO:
	 [Node] Running &#34;selectfiles&#34; (&#34;nipype.interfaces.io.SelectFiles&#34;)
190416-12:41:18,452 nipype.workflow INFO:
	 [Node] Running &#34;selectfiles&#34; (&#34;nipype.interfaces.io.SelectFiles&#34;)
190416-12:41:18,498 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.selectfiles&#34;.
190416-12:41:18,500 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.selectfiles&#34;.
190416-12:41:18,501 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.selectfiles&#34;.
190416-12:41:18,508 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.selectfiles&#34;.
190416-12:41:18,510 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.selectfiles&#34;.
190416-12:41:18,510 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.selectfiles&#34;.
190416-12:41:19,960 nipype.workflow INFO:
	 [Job 0] Completed (work_preproc.selectfiles).
190416-12:41:19,966 nipype.workflow INFO:
	 [Job 22] Completed (work_preproc.selectfiles).
190416-12:41:19,970 nipype.workflow INFO:
	 [Job 44] Completed (work_preproc.selectfiles).
190416-12:41:19,973 nipype.workflow INFO:
	 [Job 66] Completed (work_preproc.selectfiles).
190416-12:41:19,976 nipype.workflow INFO:
	 [Job 88] Completed (work_preproc.selectfiles).
190416-12:41:19,980 nipype.workflow INFO:
	 [Job 110] Completed (work_preproc.selectfiles).
190416-12:41:19,985 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 12 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 8/8.
190416-12:41:20,173 nipype.workflow INFO:
	 [Job 1] Cached (work_preproc.gunzip_func).
190416-12:41:20,182 nipype.workflow INFO:
	 [Job 6] Cached (work_preproc.gunzip_anat).
190416-12:41:20,190 nipype.workflow INFO:
	 [Job 23] Cached (work_preproc.gunzip_func).
190416-12:41:20,198 nipype.workflow INFO:
	 [Job 28] Cached (work_preproc.gunzip_anat).
190416-12:41:20,206 nipype.workflow INFO:
	 [Job 45] Cached (work_preproc.gunzip_func).
190416-12:41:20,214 nipype.workflow INFO:
	 [Job 50] Cached (work_preproc.gunzip_anat).
190416-12:41:20,222 nipype.workflow INFO:
	 [Job 67] Cached (work_preproc.gunzip_func).
190416-12:41:20,230 nipype.workflow INFO:
	 [Job 72] Cached (work_preproc.gunzip_anat).
190416-12:41:22,101 nipype.workflow INFO:
	 [Job 2] Cached (work_preproc.extract).
190416-12:41:22,114 nipype.workflow INFO:
	 [Job 7] Cached (work_preproc.segment).
190416-12:41:22,125 nipype.workflow INFO:
	 [Job 24] Cached (work_preproc.extract).
190416-12:41:22,138 nipype.workflow INFO:
	 [Job 29] Cached (work_preproc.segment).
190416-12:41:22,148 nipype.workflow INFO:
	 [Job 46] Cached (work_preproc.extract).
190416-12:41:22,157 nipype.workflow INFO:
	 [Job 51] Cached (work_preproc.segment).
190416-12:41:22,166 nipype.workflow INFO:
	 [Job 68] Cached (work_preproc.extract).
190416-12:41:22,180 nipype.workflow INFO:
	 [Job 73] Cached (work_preproc.segment).
190416-12:41:23,964 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 16 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 8/8.
190416-12:41:24,109 nipype.workflow INFO:
	 [Job 3] Cached (work_preproc.slicetime).
190416-12:41:24,125 nipype.workflow INFO:
	 [Job 8] Cached (work_preproc.resample).
190416-12:41:24,142 nipype.workflow INFO:
	 [Job 10] Cached (work_preproc.threshold_WM).
190416-12:41:24,155 nipype.workflow INFO:
	 [Job 25] Cached (work_preproc.slicetime).
190416-12:41:24,171 nipype.workflow INFO:
	 [Job 30] Cached (work_preproc.resample).
190416-12:41:24,179 nipype.workflow INFO:
	 [Job 32] Cached (work_preproc.threshold_WM).
190416-12:41:24,188 nipype.workflow INFO:
	 [Job 47] Cached (work_preproc.slicetime).
190416-12:41:24,208 nipype.workflow INFO:
	 [Job 52] Cached (work_preproc.resample).
190416-12:41:25,965 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 14 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 8/8.
190416-12:41:26,101 nipype.workflow INFO:
	 [Job 4] Cached (work_preproc.mcflirt).
190416-12:41:26,112 nipype.workflow INFO:
	 [Job 9] Cached (work_preproc.mask_GM).
190416-12:41:26,120 nipype.workflow INFO:
	 [Job 26] Cached (work_preproc.mcflirt).
190416-12:41:26,129 nipype.workflow INFO:
	 [Job 31] Cached (work_preproc.mask_GM).
190416-12:41:26,137 nipype.workflow INFO:
	 [Job 48] Cached (work_preproc.mcflirt).
190416-12:41:26,146 nipype.workflow INFO:
	 [Job 53] Cached (work_preproc.mask_GM).
190416-12:41:26,154 nipype.workflow INFO:
	 [Job 54] Cached (work_preproc.threshold_WM).
190416-12:41:26,164 nipype.workflow INFO:
	 [Job 69] Cached (work_preproc.slicetime).
190416-12:41:27,966 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 13 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 8/8.
190416-12:41:28,108 nipype.workflow INFO:
	 [Job 5] Cached (work_preproc.art).
190416-12:41:28,125 nipype.workflow INFO:
	 [Job 11] Cached (work_preproc.coreg).
190416-12:41:28,144 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.art&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_08/art&#34;.
190416-12:41:28,154 nipype.workflow INFO:
	 [Job 33] Cached (work_preproc.coreg).
190416-12:41:28,171 nipype.workflow INFO:
	 [Job 49] Cached (work_preproc.art).
190416-12:41:28,188 nipype.workflow INFO:
	 [Job 55] Cached (work_preproc.coreg).
190416-12:41:28,196 nipype.workflow INFO:
	 [Job 70] Cached (work_preproc.mcflirt).
190416-12:41:28,209 nipype.workflow INFO:
	 [Job 74] Cached (work_preproc.resample).
190416-12:41:28,246 nipype.workflow INFO:
	 [Node] Running &#34;art&#34; (&#34;nipype.algorithms.rapidart.ArtifactDetect&#34;)
190416-12:41:29,479 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.art&#34;.
190416-12:41:29,966 nipype.workflow INFO:
	 [Job 27] Completed (work_preproc.art).
190416-12:41:29,973 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 10 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 8/8.
190416-12:41:30,115 nipype.workflow INFO:
	 [Job 12] Cached (work_preproc.applywarp).
190416-12:41:30,130 nipype.workflow INFO:
	 [Job 34] Cached (work_preproc.applywarp).
190416-12:41:30,145 nipype.workflow INFO:
	 [Job 56] Cached (work_preproc.applywarp).
190416-12:41:30,158 nipype.workflow INFO:
	 [Job 71] Cached (work_preproc.art).
190416-12:41:30,167 nipype.workflow INFO:
	 [Job 75] Cached (work_preproc.mask_GM).
190416-12:41:30,175 nipype.workflow INFO:
	 [Job 76] Cached (work_preproc.threshold_WM).
190416-12:41:30,183 nipype.workflow INFO:
	 [Job 89] Cached (work_preproc.gunzip_func).
190416-12:41:30,190 nipype.workflow INFO:
	 [Job 94] Cached (work_preproc.gunzip_anat).
190416-12:41:31,969 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 11 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 8/8.
190416-12:41:32,112 nipype.workflow INFO:
	 [Job 13] Cached (work_preproc.susan.mask).
190416-12:41:32,128 nipype.workflow INFO:
	 [Job 15] Cached (work_preproc.susan.median).
190416-12:41:32,144 nipype.workflow INFO:
	 [Job 35] Cached (work_preproc.susan.mask).
190416-12:41:32,158 nipype.workflow INFO:
	 [Job 37] Cached (work_preproc.susan.median).
190416-12:41:32,171 nipype.workflow INFO:
	 [Job 57] Cached (work_preproc.susan.mask).
190416-12:41:32,183 nipype.workflow INFO:
	 [Job 59] Cached (work_preproc.susan.median).
190416-12:41:32,198 nipype.workflow INFO:
	 [Job 77] Cached (work_preproc.coreg).
190416-12:41:32,207 nipype.workflow INFO:
	 [Job 90] Cached (work_preproc.extract).
190416-12:41:33,971 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 8 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 8/8.
190416-12:41:34,172 nipype.workflow INFO:
	 [Job 14] Cached (work_preproc.susan.meanfunc2).
190416-12:41:34,196 nipype.workflow INFO:
	 [Job 36] Cached (work_preproc.susan.meanfunc2).
190416-12:41:34,210 nipype.workflow INFO:
	 [Job 58] Cached (work_preproc.susan.meanfunc2).
190416-12:41:34,227 nipype.workflow INFO:
	 [Job 78] Cached (work_preproc.applywarp).
190416-12:41:34,237 nipype.workflow INFO:
	 [Job 91] Cached (work_preproc.slicetime).
190416-12:41:34,248 nipype.workflow INFO:
	 [Job 95] Cached (work_preproc.segment).
190416-12:41:34,255 nipype.workflow INFO:
	 [Job 111] Cached (work_preproc.gunzip_func).
190416-12:41:34,262 nipype.workflow INFO:
	 [Job 116] Cached (work_preproc.gunzip_anat).
190416-12:41:35,973 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 10 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 8/8.
190416-12:41:36,136 nipype.workflow INFO:
	 [Job 16] Cached (work_preproc.susan.merge).
190416-12:41:36,150 nipype.workflow INFO:
	 [Job 38] Cached (work_preproc.susan.merge).
190416-12:41:36,163 nipype.workflow INFO:
	 [Job 60] Cached (work_preproc.susan.merge).
190416-12:41:36,181 nipype.workflow INFO:
	 [Job 79] Cached (work_preproc.susan.mask).
190416-12:41:36,197 nipype.workflow INFO:
	 [Job 81] Cached (work_preproc.susan.median).
190416-12:41:36,208 nipype.workflow INFO:
	 [Job 92] Cached (work_preproc.mcflirt).
190416-12:41:36,224 nipype.workflow INFO:
	 [Job 96] Cached (work_preproc.resample).
190416-12:41:36,234 nipype.workflow INFO:
	 [Job 98] Cached (work_preproc.threshold_WM).
190416-12:41:37,974 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 9 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 8/8.
190416-12:41:38,122 nipype.workflow INFO:
	 [Job 17] Cached (work_preproc.susan.multi_inputs).
190416-12:41:38,138 nipype.workflow INFO:
	 [Job 39] Cached (work_preproc.susan.multi_inputs).
190416-12:41:38,152 nipype.workflow INFO:
	 [Job 61] Cached (work_preproc.susan.multi_inputs).
190416-12:41:38,167 nipype.workflow INFO:
	 [Job 80] Cached (work_preproc.susan.meanfunc2).
190416-12:41:38,181 nipype.workflow INFO:
	 [Job 93] Cached (work_preproc.art).
190416-12:41:38,194 nipype.workflow INFO:
	 [Job 97] Cached (work_preproc.mask_GM).
190416-12:41:38,210 nipype.workflow INFO:
	 [Job 99] Cached (work_preproc.coreg).
190416-12:41:38,219 nipype.workflow INFO:
	 [Job 112] Cached (work_preproc.extract).
190416-12:41:39,977 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 7 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 8/8.
190416-12:41:40,161 nipype.workflow INFO:
	 [Job 18] Cached (work_preproc.susan.smooth).
190416-12:41:40,187 nipype.workflow INFO:
	 [Job 40] Cached (work_preproc.susan.smooth).
190416-12:41:40,208 nipype.workflow INFO:
	 [Job 62] Cached (work_preproc.susan.smooth).
190416-12:41:40,239 nipype.workflow INFO:
	 [Job 82] Cached (work_preproc.susan.merge).
190416-12:41:40,256 nipype.workflow INFO:
	 [Job 100] Cached (work_preproc.applywarp).
190416-12:41:40,266 nipype.workflow INFO:
	 [Job 113] Cached (work_preproc.slicetime).
190416-12:41:40,277 nipype.workflow INFO:
	 [Job 117] Cached (work_preproc.segment).
190416-12:41:41,980 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 9 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 8/8.
190416-12:41:42,164 nipype.workflow INFO:
	 [Job 19] Cached (work_preproc.mask_func).
190416-12:41:42,181 nipype.workflow INFO:
	 [Job 41] Cached (work_preproc.mask_func).
190416-12:41:42,198 nipype.workflow INFO:
	 [Job 63] Cached (work_preproc.mask_func).
190416-12:41:42,215 nipype.workflow INFO:
	 [Job 83] Cached (work_preproc.susan.multi_inputs).
190416-12:41:42,231 nipype.workflow INFO:
	 [Job 101] Cached (work_preproc.susan.mask).
190416-12:41:42,245 nipype.workflow INFO:
	 [Job 103] Cached (work_preproc.susan.median).
190416-12:41:42,258 nipype.workflow INFO:
	 [Job 114] Cached (work_preproc.mcflirt).
190416-12:41:42,272 nipype.workflow INFO:
	 [Job 118] Cached (work_preproc.resample).
190416-12:41:43,981 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 8 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 8/8.
190416-12:41:44,129 nipype.workflow INFO:
	 [Job 20] Cached (work_preproc.detrend).
190416-12:41:44,139 nipype.workflow INFO:
	 [Job 42] Cached (work_preproc.detrend).
190416-12:41:44,150 nipype.workflow INFO:
	 [Job 64] Cached (work_preproc.detrend).
190416-12:41:44,174 nipype.workflow INFO:
	 [Job 84] Cached (work_preproc.susan.smooth).
190416-12:41:44,189 nipype.workflow INFO:
	 [Job 102] Cached (work_preproc.susan.meanfunc2).
190416-12:41:44,204 nipype.workflow INFO:
	 [Job 115] Cached (work_preproc.art).
190416-12:41:44,213 nipype.workflow INFO:
	 [Job 119] Cached (work_preproc.mask_GM).
190416-12:41:44,223 nipype.workflow INFO:
	 [Job 120] Cached (work_preproc.threshold_WM).
190416-12:41:45,982 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 6 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 8/8.
190416-12:41:46,160 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.datasink&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_09/datasink&#34;.
190416-12:41:46,180 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.datasink&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_08/datasink&#34;.
190416-12:41:46,205 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.datasink&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_07/datasink&#34;.
190416-12:41:46,222 nipype.workflow INFO:
	 [Job 85] Cached (work_preproc.mask_func).
190416-12:41:46,230 nipype.workflow INFO:
	 [Node] Running &#34;datasink&#34; (&#34;nipype.interfaces.io.DataSink&#34;)
190416-12:41:46,235 nipype.interface INFO:
	 sub: /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/_subject_id_08/asub-08_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz.par -&gt; /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/sub-08.par
190416-12:41:46,241 nipype.workflow INFO:
	 [Node] Running &#34;datasink&#34; (&#34;nipype.interfaces.io.DataSink&#34;)
190416-12:41:46,242 nipype.workflow INFO:
	 [Job 104] Cached (work_preproc.susan.merge).
190416-12:41:46,245 nipype.interface INFO:
	 sub: /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/_subject_id_09/asub-09_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz.par -&gt; /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/sub-09.par
190416-12:41:46,246 nipype.interface INFO:
	 sub: /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/_subject_id_08/art.asub-08_ses-test_task-fingerfootlips_bold_roi_mcf_outliers.txt -&gt; /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/art.sub-08_outliers.txt
190416-12:41:46,248 nipype.interface INFO:
	 sub: /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/_subject_id_09/art.asub-09_ses-test_task-fingerfootlips_bold_roi_mcf_outliers.txt -&gt; /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/art.sub-09_outliers.txt
190416-12:41:46,252 nipype.interface INFO:
	 sub: /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/_subject_id_08/plot.asub-08_ses-test_task-fingerfootlips_bold_roi_mcf.svg -&gt; /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/plot.sub-08.svg
190416-12:41:46,251 nipype.interface INFO:
	 sub: /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/_subject_id_09/plot.asub-09_ses-test_task-fingerfootlips_bold_roi_mcf.svg -&gt; /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/plot.sub-09.svg
190416-12:41:46,255 nipype.interface INFO:
	 sub: /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/_subject_id_09/detrend.nii.gz -&gt; /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/sub-09_detrend.nii.gz
190416-12:41:46,266 nipype.interface INFO:
	 sub: /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/_subject_id_08/detrend.nii.gz -&gt; /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/sub-08_detrend.nii.gz
190416-12:41:46,269 nipype.workflow INFO:
	 [Job 121] Cached (work_preproc.coreg).
190416-12:41:46,297 nipype.workflow INFO:
	 [Node] Running &#34;datasink&#34; (&#34;nipype.interfaces.io.DataSink&#34;)
190416-12:41:46,301 nipype.interface INFO:
	 sub: /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/_subject_id_07/asub-07_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz.par -&gt; /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/sub-07.par
190416-12:41:46,304 nipype.interface INFO:
	 sub: /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/_subject_id_07/art.asub-07_ses-test_task-fingerfootlips_bold_roi_mcf_outliers.txt -&gt; /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/art.sub-07_outliers.txt
190416-12:41:46,306 nipype.interface INFO:
	 sub: /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/_subject_id_07/plot.asub-07_ses-test_task-fingerfootlips_bold_roi_mcf.svg -&gt; /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/plot.sub-07.svg
190416-12:41:46,309 nipype.interface INFO:
	 sub: /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/_subject_id_07/detrend.nii.gz -&gt; /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/sub-07_detrend.nii.gz
190416-12:41:46,311 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.datasink&#34;.
190416-12:41:46,316 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.datasink&#34;.
190416-12:41:46,352 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.datasink&#34;.
190416-12:41:47,983 nipype.workflow INFO:
	 [Job 21] Completed (work_preproc.datasink).
190416-12:41:47,986 nipype.workflow INFO:
	 [Job 43] Completed (work_preproc.datasink).
190416-12:41:47,989 nipype.workflow INFO:
	 [Job 65] Completed (work_preproc.datasink).
190416-12:41:47,994 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 3 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 8/8.
190416-12:41:48,140 nipype.workflow INFO:
	 [Job 86] Cached (work_preproc.detrend).
190416-12:41:48,157 nipype.workflow INFO:
	 [Job 105] Cached (work_preproc.susan.multi_inputs).
190416-12:41:48,173 nipype.workflow INFO:
	 [Job 122] Cached (work_preproc.applywarp).
190416-12:41:49,987 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 4 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 8/8.
190416-12:41:50,186 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.datasink&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_04/datasink&#34;.
190416-12:41:50,205 nipype.workflow INFO:
	 [Job 106] Cached (work_preproc.susan.smooth).
190416-12:41:50,232 nipype.workflow INFO:
	 [Job 123] Cached (work_preproc.susan.mask).
190416-12:41:50,250 nipype.workflow INFO:
	 [Job 125] Cached (work_preproc.susan.median).
190416-12:41:50,291 nipype.workflow INFO:
	 [Node] Running &#34;datasink&#34; (&#34;nipype.interfaces.io.DataSink&#34;)
190416-12:41:50,296 nipype.interface INFO:
	 sub: /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/_subject_id_04/asub-04_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz.par -&gt; /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/sub-04.par
190416-12:41:50,300 nipype.interface INFO:
	 sub: /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/_subject_id_04/art.asub-04_ses-test_task-fingerfootlips_bold_roi_mcf_outliers.txt -&gt; /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/art.sub-04_outliers.txt
190416-12:41:50,303 nipype.interface INFO:
	 sub: /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/_subject_id_04/plot.asub-04_ses-test_task-fingerfootlips_bold_roi_mcf.svg -&gt; /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/plot.sub-04.svg
190416-12:41:50,306 nipype.interface INFO:
	 sub: /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/_subject_id_04/detrend.nii.gz -&gt; /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/sub-04_detrend.nii.gz
190416-12:41:50,346 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.datasink&#34;.
190416-12:41:51,987 nipype.workflow INFO:
	 [Job 87] Completed (work_preproc.datasink).
190416-12:41:51,993 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 8/8.
190416-12:41:52,164 nipype.workflow INFO:
	 [Job 107] Cached (work_preproc.mask_func).
190416-12:41:52,197 nipype.workflow INFO:
	 [Job 124] Cached (work_preproc.susan.meanfunc2).
190416-12:41:54,160 nipype.workflow INFO:
	 [Job 108] Cached (work_preproc.detrend).
190416-12:41:54,177 nipype.workflow INFO:
	 [Job 126] Cached (work_preproc.susan.merge).
190416-12:41:56,189 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.datasink&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_03/datasink&#34;.
190416-12:41:56,207 nipype.workflow INFO:
	 [Job 127] Cached (work_preproc.susan.multi_inputs).
190416-12:41:56,283 nipype.workflow INFO:
	 [Node] Running &#34;datasink&#34; (&#34;nipype.interfaces.io.DataSink&#34;)
190416-12:41:56,288 nipype.interface INFO:
	 sub: /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/_subject_id_03/asub-03_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz.par -&gt; /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/sub-03.par
190416-12:41:56,292 nipype.interface INFO:
	 sub: /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/_subject_id_03/art.asub-03_ses-test_task-fingerfootlips_bold_roi_mcf_outliers.txt -&gt; /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/art.sub-03_outliers.txt
190416-12:41:56,295 nipype.interface INFO:
	 sub: /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/_subject_id_03/plot.asub-03_ses-test_task-fingerfootlips_bold_roi_mcf.svg -&gt; /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/plot.sub-03.svg
190416-12:41:56,298 nipype.interface INFO:
	 sub: /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/_subject_id_03/detrend.nii.gz -&gt; /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/sub-03_detrend.nii.gz
190416-12:41:56,338 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.datasink&#34;.
190416-12:41:57,991 nipype.workflow INFO:
	 [Job 109] Completed (work_preproc.datasink).
190416-12:41:57,997 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 1 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 8/8.
190416-12:41:58,153 nipype.workflow INFO:
	 [Job 128] Cached (work_preproc.susan.smooth).
190416-12:42:00,140 nipype.workflow INFO:
	 [Job 129] Cached (work_preproc.mask_func).
190416-12:42:02,143 nipype.workflow INFO:
	 [Job 130] Cached (work_preproc.detrend).
190416-12:42:04,164 nipype.workflow INFO:
	 [Node] Setting-up &#34;work_preproc.datasink&#34; in &#34;/dartfs/rc/lab/P/Psych60/students_output/f00275v/7_nipype_preprocessing/output/work_preproc/_subject_id_02/datasink&#34;.
190416-12:42:04,259 nipype.workflow INFO:
	 [Node] Running &#34;datasink&#34; (&#34;nipype.interfaces.io.DataSink&#34;)
190416-12:42:04,265 nipype.interface INFO:
	 sub: /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/_subject_id_02/asub-02_ses-test_task-fingerfootlips_bold_roi_mcf.nii.gz.par -&gt; /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/sub-02.par
190416-12:42:04,269 nipype.interface INFO:
	 sub: /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/_subject_id_02/art.asub-02_ses-test_task-fingerfootlips_bold_roi_mcf_outliers.txt -&gt; /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/art.sub-02_outliers.txt
190416-12:42:04,272 nipype.interface INFO:
	 sub: /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/_subject_id_02/plot.asub-02_ses-test_task-fingerfootlips_bold_roi_mcf.svg -&gt; /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/plot.sub-02.svg
190416-12:42:04,276 nipype.interface INFO:
	 sub: /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/_subject_id_02/detrend.nii.gz -&gt; /dartfs-hpc/rc/home/v/f00275v/Psych60/students_output/f00275v/7_nipype_preprocessing/output/datasink_handson/preproc/sub-02_detrend.nii.gz
190416-12:42:04,327 nipype.workflow INFO:
	 [Node] Finished &#34;work_preproc.datasink&#34;.
190416-12:42:05,999 nipype.workflow INFO:
	 [Job 131] Completed (work_preproc.datasink).
190416-12:42:06,4 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 0 jobs ready. Free memory (GB): 56.38/56.38, Free processors: 8/8.
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;networkx.classes.digraph.DiGraph at 0x2ad278abffd0&gt;</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

 


    </main>
    