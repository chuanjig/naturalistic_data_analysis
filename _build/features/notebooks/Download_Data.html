---
redirect_from:
  - "/features/notebooks/download-data"
interact_link: content/features/notebooks/Download_Data.ipynb
kernel_name: conda-env-py36-py
kernel_path: content/features/notebooks
has_widgets: false
title: |-
  Download Localizer Data
pagenum: 8
prev_page:
  url: /features/notebooks/2_Introduction_to_Dataframes_Plotting.html
next_page:
  url: /features/notebooks/Glossary.html
suffix: .ipynb
search: data download lets f contains localizer create file load task also dataset subjects need list using get functional looks correctly nibabel dimension tutorials pinel several different types visual e modality auditory trials total read specific available only subject s function datasets choose preprocessed feel free datatype want images preprocessing dont set datadir ok structural metadata description braindata fix shape dimensions extra numpy array correct new instance imaging open designed probe basic cognitive processes such perception finger tapping language math tasks cued reading text screen hearing instructions randomized across conditions optimized maximize efficiency rapid event related design minute scanning session paper

comment: "***PROGRAMMATICALLY GENERATED, DO NOT EDIT. SEE ORIGINAL FILES IN /content***"
---

    <main class="jupyter-page">
    <div id="page-info"><div id="page-title">Download Localizer Data</div>
</div>
    
<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Download-Localizer-Data">Download Localizer Data<a class="anchor-link" href="#Download-Localizer-Data"> </a></h1><p>Many of the imaging tutorials will use open data from the Pinel Localizer task.</p>
<p>The Pinel Localizer task was designed to probe several different types of basic cognitive processes, such as visual perception, finger tapping, language, and math. Several of the tasks are cued by reading text on the screen (i.e., visual modality) and also by hearing auditory instructions (i.e., auditory modality). The trials are randomized across conditions and have been optimized to maximize efficiency for a rapid event related design. There are 100 trials in total over a 5-minute scanning session. Read the <a href="https://bmcneurosci.biomedcentral.com/articles/10.1186/1471-2202-8-91">paper</a> for more specific details about the task. You can also view the <a href="http://brainomics.cea.fr/localizer/dataset?rql=Any%20X%2C%20XT%2C%20XL%2C%20XI%2C%20XF%2C%20XD%20WHERE%20X%20is%20Scan%2C%20X%20type%20XT%2C%20X%20label%20XL%2C%20X%20identifier%20XI%2C%20X%20format%20XF%2C%20X%20description%20XD">Data</a> on the authorâ€™s cubicweb interface.</p>
<p>This dataset is well suited for these tutorials as it is (a) publicly available to anyone in the world, (b) relatively small (only about 5min), and (c) provides many options to create different types of contrasts.</p>
<p>There are a total of 94 subjects available, but we will primarily only be working with a smaller subset of about 30.</p>
<p>Downloading the data is very easy.  All we need to do is specify a directory to download and unpack it.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">nltools.data</span> <span class="k">import</span> <span class="n">Brain_Data</span>
<span class="kn">from</span> <span class="nn">nltools.datasets</span> <span class="k">import</span> <span class="n">fetch_localizer</span>

<span class="n">data_dir</span> <span class="o">=</span> <span class="s1">&#39;/Users/lukechang/nilearn_data/brainomics_localizer/&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We first will create a list of subject identification numbers from 's01' to 's30'.  Then we will download all of the subjects one by one using the <code>fetch_localizer</code> function from <code>nltools.datasets</code>.  You can easily modify this code to download more or less subjects.</p>
<p>We can choose to download either the 'raw' or 'preprocessed' data. Feel free to download both, but you will have to change the <code>data_type</code> and rerun the function.</p>
<p>We can also choose if we want to download the anatomical images. This is useful for running preprocessing later.</p>
<p>If you are eager to get going and don't plan on preprocessing the data yourself, feel free to set <code>get_anats=False, data_type='preprocessed'</code> to download the bare minimum.</p>
<p>Don't forget to set <code>data_dir=data_dir</code> if you want to put the data in a specific folder.  Otherwise it will default to <code>~/nilearn_data/brainomics_localizer/</code>.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sub_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="s1">&#39;S</span><span class="si">{x:02}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">31</span><span class="p">)]</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">fetch_localizer</span><span class="p">(</span><span class="n">subject_ids</span><span class="o">=</span><span class="n">sub_ids</span><span class="p">,</span> <span class="n">get_anats</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;raw&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Downloading data from http://brainomics.cea.fr/localizer/dataset/cubicwebexport.csv ...
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Downloaded 1555 of 1555 bytes (100.0%,    0.0s remaining) ...done. (1 seconds, 0 min)
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Downloading data from http://brainomics.cea.fr/localizer/dataset/cubicwebexport2.csv ...
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Downloaded 64001 of 64001 bytes (100.0%,    0.0s remaining) ...done. (4 seconds, 0 min)
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Ok, we have now downloaded all of the data!</p>
<p>The <code>f</code> variable contains a dictionary of all of the relevant data.</p>
<ul>
<li><code>f['functional']</code>: contains a list of the functional data.</li>
<li><code>f['structural']</code>: contains a list of the structural data.</li>
<li><code>f['ext_vars']</code>: contains all of the subject metadata</li>
<li><code>f['description']</code>: contains a brief description of the dataset.</li>
</ul>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Brainomics Localizer


Notes
-----
A protocol that captures the cerebral bases of auditory and
visual perception, motor actions, reading, language comprehension
and mental calculation at an individual level. Individual functional
maps are reliable and quite precise.


Content
-------
    :&#39;func&#39;: Nifti images of the neural activity maps
    :&#39;cmaps&#39;: Nifti images of contrast maps
    :&#39;tmaps&#39;: Nifti images of corresponding t-maps
    :&#39;masks&#39;: Structural images of the mask used for each subject.
    :&#39;anats&#39;: Structural images of anatomy of each subject

References
----------
For more information about this dataset&#39;s structure:
http://brainomics.cea.fr/localizer/

To cite this dataset:
Papadopoulos Orfanos, Dimitri, et al.
&#34;The Brainomics/Localizer database.&#34;
NeuroImage 144.B (2017): 309.

For an example of scientific results obtained using this dataset:
Pinel, Philippe, et al.
&#34;Fast reproducible identification and large-scale databasing of
 individual functional cognitive networks.&#34;
BMC Neuroscience 8.1 (2007): 91.

Licence: usage is unrestricted for non-commercial research purposes.

</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now let's take a look inside the metadata file.</p>
<p>It is a pandas data frame with info about each participant.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;ext_vars&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Ok, now let's try to load one of the functional datasets using <code>Brain_Data</code>.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">Brain_Data</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;functional&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">DimensionError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-56-d493f847f938&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>data <span class="ansi-blue-fg">=</span> Brain_Data<span class="ansi-blue-fg">(</span>f<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;functional&#39;</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/anaconda3/envs/py36/lib/python3.6/site-packages/nltools-0.3.13-py3.6.egg/nltools/data/brain_data.py</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, data, Y, X, mask, output_file, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    130</span>                             <span class="ansi-green-fg">if</span> isinstance<span class="ansi-blue-fg">(</span>i<span class="ansi-blue-fg">,</span> six<span class="ansi-blue-fg">.</span>string_types<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    131</span>                                 self.data.append(self.nifti_masker.fit_transform(
<span class="ansi-green-fg">--&gt; 132</span><span class="ansi-red-fg">                                                  nib.load(i)))
</span><span class="ansi-green-intense-fg ansi-bold">    133</span>                             <span class="ansi-green-fg">elif</span> isinstance<span class="ansi-blue-fg">(</span>i<span class="ansi-blue-fg">,</span> nib<span class="ansi-blue-fg">.</span>Nifti1Image<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    134</span>                                 self<span class="ansi-blue-fg">.</span>data<span class="ansi-blue-fg">.</span>append<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>nifti_masker<span class="ansi-blue-fg">.</span>fit_transform<span class="ansi-blue-fg">(</span>i<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/anaconda3/envs/py36/lib/python3.6/site-packages/nilearn/input_data/base_masker.py</span> in <span class="ansi-cyan-fg">fit_transform</span><span class="ansi-blue-fg">(self, X, y, confounds, **fit_params)</span>
<span class="ansi-green-intense-fg ansi-bold">    205</span>                                 ).transform(X, confounds=confounds)
<span class="ansi-green-intense-fg ansi-bold">    206</span>             <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 207</span><span class="ansi-red-fg">                 </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>fit<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">**</span>fit_params<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>transform<span class="ansi-blue-fg">(</span>X<span class="ansi-blue-fg">,</span> confounds<span class="ansi-blue-fg">=</span>confounds<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    208</span>         <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    209</span>             <span class="ansi-red-fg"># fit method of arity 2 (supervised transformation)</span>

<span class="ansi-green-fg">~/anaconda3/envs/py36/lib/python3.6/site-packages/nilearn/input_data/base_masker.py</span> in <span class="ansi-cyan-fg">transform</span><span class="ansi-blue-fg">(self, imgs, confounds)</span>
<span class="ansi-green-intense-fg ansi-bold">    175</span>         self<span class="ansi-blue-fg">.</span>_check_fitted<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    176</span> 
<span class="ansi-green-fg">--&gt; 177</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>transform_single_imgs<span class="ansi-blue-fg">(</span>imgs<span class="ansi-blue-fg">,</span> confounds<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    178</span> 
<span class="ansi-green-intense-fg ansi-bold">    179</span>     <span class="ansi-green-fg">def</span> fit_transform<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> X<span class="ansi-blue-fg">,</span> y<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> confounds<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>fit_params<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/anaconda3/envs/py36/lib/python3.6/site-packages/nilearn/input_data/nifti_masker.py</span> in <span class="ansi-cyan-fg">transform_single_imgs</span><span class="ansi-blue-fg">(self, imgs, confounds, copy)</span>
<span class="ansi-green-intense-fg ansi-bold">    306</span>             confounds<span class="ansi-blue-fg">=</span>confounds<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    307</span>             copy<span class="ansi-blue-fg">=</span>copy<span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">--&gt; 308</span><span class="ansi-red-fg">             </span>dtype<span class="ansi-blue-fg">=</span>self<span class="ansi-blue-fg">.</span>dtype
<span class="ansi-green-intense-fg ansi-bold">    309</span>         )
<span class="ansi-green-intense-fg ansi-bold">    310</span> 

<span class="ansi-green-fg">~/anaconda3/envs/py36/lib/python3.6/site-packages/sklearn/externals/joblib/memory.py</span> in <span class="ansi-cyan-fg">__call__</span><span class="ansi-blue-fg">(self, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    340</span> 
<span class="ansi-green-intense-fg ansi-bold">    341</span>     <span class="ansi-green-fg">def</span> __call__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 342</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>func<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    343</span> 
<span class="ansi-green-intense-fg ansi-bold">    344</span>     <span class="ansi-green-fg">def</span> call_and_shelve<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/anaconda3/envs/py36/lib/python3.6/site-packages/nilearn/input_data/nifti_masker.py</span> in <span class="ansi-cyan-fg">filter_and_mask</span><span class="ansi-blue-fg">(imgs, mask_img_, parameters, memory_level, memory, verbose, confounds, copy, dtype)</span>
<span class="ansi-green-intense-fg ansi-bold">     36</span>                     copy<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">True</span><span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">     37</span>                     dtype=None):
<span class="ansi-green-fg">---&gt; 38</span><span class="ansi-red-fg">     </span>imgs <span class="ansi-blue-fg">=</span> _utils<span class="ansi-blue-fg">.</span>check_niimg<span class="ansi-blue-fg">(</span>imgs<span class="ansi-blue-fg">,</span> atleast_4d<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">True</span><span class="ansi-blue-fg">,</span> ensure_ndim<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">4</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     39</span> 
<span class="ansi-green-intense-fg ansi-bold">     40</span>     <span class="ansi-red-fg"># Check whether resampling is truly necessary. If so, crop mask</span>

<span class="ansi-green-fg">~/anaconda3/envs/py36/lib/python3.6/site-packages/nilearn/_utils/niimg_conversions.py</span> in <span class="ansi-cyan-fg">check_niimg</span><span class="ansi-blue-fg">(niimg, ensure_ndim, atleast_4d, dtype, return_iterator, wildcards)</span>
<span class="ansi-green-intense-fg ansi-bold">    282</span> 
<span class="ansi-green-intense-fg ansi-bold">    283</span>     <span class="ansi-green-fg">if</span> ensure_ndim <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span> <span class="ansi-green-fg">and</span> len<span class="ansi-blue-fg">(</span>niimg<span class="ansi-blue-fg">.</span>shape<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">!=</span> ensure_ndim<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 284</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">raise</span> DimensionError<span class="ansi-blue-fg">(</span>len<span class="ansi-blue-fg">(</span>niimg<span class="ansi-blue-fg">.</span>shape<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> ensure_ndim<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    285</span> 
<span class="ansi-green-intense-fg ansi-bold">    286</span>     <span class="ansi-green-fg">if</span> return_iterator<span class="ansi-blue-fg">:</span>

<span class="ansi-red-fg">DimensionError</span>: Input data has incompatible dimensionality: Expected dimension is 4D and you provided a 5D image. See http://nilearn.github.io/manipulating_images/input_output.html.</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Uh, oh...  Looks like this data was created using an older version of SPM and isn't being read correctly by <code>Brain_Data</code>.</p>
<p>Let's do our first bit of debugging and fix this.</p>
<p>We will use nibabel to load the data and inspect the shape of the data file.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">nibabel</span> <span class="k">as</span> <span class="nn">nib</span>

<span class="n">dat</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;functional&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="n">dat</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(64, 64, 40, 1, 128)</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The first 3 dimensions correspond to X, Y, &amp; Z planes.  The last dimension is time. It looks like there is an extra dimension that we will need to get rid of so that we can load the data correctly.</p>
<p>We will get the data into a numpy array and use the <code>squeeze()</code> method to collapse the extra dimension.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dat</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(64, 64, 40, 128)</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>See how we now have the correct shape?</p>
<p>Let's now create a new nibabel instance with the correct dimensions and write over the file.</p>
<p>To create a new nibabel instance, we just need to pass in the 4-D numpy array with the affine matrix.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dat</span><span class="o">.</span><span class="n">affine</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[ -3.,   0.,   0.,  96.],
       [  0.,   3.,   0., -96.],
       [  0.,   0.,   3., -60.],
       [  0.,   0.,   0.,   1.]])</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dat_fixed</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">Nifti1Image</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">dat</span><span class="o">.</span><span class="n">affine</span><span class="p">)</span>
<span class="n">nib</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">dat_fixed</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;functional&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's check and see if we can correctly load the file now.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">Brain_Data</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;functional&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="n">data</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>nltools.data.brain_data.Brain_Data(data=(128, 238955), Y=0, X=(0, 0), mask=MNI152_T1_2mm_brain_mask.nii.gz, output_file=[])</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Great!  Looks like we fixed it.  Let's now fix all of the rest of the images so that we won't have this problem again.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;functional&#39;</span><span class="p">]:</span>
    <span class="n">dat</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_name</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">dat_fixed</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">Nifti1Image</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">dat</span><span class="o">.</span><span class="n">affine</span><span class="p">)</span>
        <span class="n">nib</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">dat_fixed</span><span class="p">,</span> <span class="n">file_name</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

 


    </main>
    